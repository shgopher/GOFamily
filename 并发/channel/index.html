<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GOFamily - go ç¨‹åºå‘˜å®å…¸</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" type="image/x-icon" href="/GOFamily/favicon.ico">
    <meta name="description" content="ğŸ”¥ go ç¨‹åºå‘˜å®å…¸ï¼ŒåŒ…å«äº†ï¼šç®—æ³•ï¼Œæ•°æ®åº“ï¼Œç½‘ç»œæ“ä½œç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ï¼Œç³»ç»Ÿè®¾è®¡ç­‰ä¸€æ½å­çŸ¥è¯†ä½“ç³»">
    
    <link rel="preload" href="/GOFamily/assets/css/0.styles.93ee3edc.css" as="style"><link rel="preload" href="/GOFamily/assets/js/app.6dac5fbf.js" as="script"><link rel="preload" href="/GOFamily/assets/js/2.5c331e53.js" as="script"><link rel="preload" href="/GOFamily/assets/js/106.ee0a923b.js" as="script"><link rel="prefetch" href="/GOFamily/assets/js/10.993cf521.js"><link rel="prefetch" href="/GOFamily/assets/js/100.8a13422e.js"><link rel="prefetch" href="/GOFamily/assets/js/101.56e8a149.js"><link rel="prefetch" href="/GOFamily/assets/js/102.0befb22b.js"><link rel="prefetch" href="/GOFamily/assets/js/103.318b2dd9.js"><link rel="prefetch" href="/GOFamily/assets/js/104.5190ec56.js"><link rel="prefetch" href="/GOFamily/assets/js/105.27135b71.js"><link rel="prefetch" href="/GOFamily/assets/js/107.abf9bc9d.js"><link rel="prefetch" href="/GOFamily/assets/js/108.339b1d12.js"><link rel="prefetch" href="/GOFamily/assets/js/109.7ee4cfe4.js"><link rel="prefetch" href="/GOFamily/assets/js/11.0307bcae.js"><link rel="prefetch" href="/GOFamily/assets/js/110.25bb24d2.js"><link rel="prefetch" href="/GOFamily/assets/js/111.800f7506.js"><link rel="prefetch" href="/GOFamily/assets/js/112.b73333d2.js"><link rel="prefetch" href="/GOFamily/assets/js/113.3bed7499.js"><link rel="prefetch" href="/GOFamily/assets/js/114.c126b120.js"><link rel="prefetch" href="/GOFamily/assets/js/115.773ca7ce.js"><link rel="prefetch" href="/GOFamily/assets/js/12.521ef871.js"><link rel="prefetch" href="/GOFamily/assets/js/13.6a579e8b.js"><link rel="prefetch" href="/GOFamily/assets/js/14.fa863532.js"><link rel="prefetch" href="/GOFamily/assets/js/15.ccbbdb7a.js"><link rel="prefetch" href="/GOFamily/assets/js/16.2a7384f8.js"><link rel="prefetch" href="/GOFamily/assets/js/17.50442aef.js"><link rel="prefetch" href="/GOFamily/assets/js/18.4b8a1599.js"><link rel="prefetch" href="/GOFamily/assets/js/19.fce83f0a.js"><link rel="prefetch" href="/GOFamily/assets/js/20.c57281b8.js"><link rel="prefetch" href="/GOFamily/assets/js/21.19939807.js"><link rel="prefetch" href="/GOFamily/assets/js/22.a6f2abf2.js"><link rel="prefetch" href="/GOFamily/assets/js/23.a3a10d16.js"><link rel="prefetch" href="/GOFamily/assets/js/24.edf743ad.js"><link rel="prefetch" href="/GOFamily/assets/js/25.c1fe94a5.js"><link rel="prefetch" href="/GOFamily/assets/js/26.529d156a.js"><link rel="prefetch" href="/GOFamily/assets/js/27.baf2939d.js"><link rel="prefetch" href="/GOFamily/assets/js/28.69e5608b.js"><link rel="prefetch" href="/GOFamily/assets/js/29.742dd6e8.js"><link rel="prefetch" href="/GOFamily/assets/js/3.159fe1e3.js"><link rel="prefetch" href="/GOFamily/assets/js/30.4aafb94a.js"><link rel="prefetch" href="/GOFamily/assets/js/31.87baab0b.js"><link rel="prefetch" href="/GOFamily/assets/js/32.1ea926c5.js"><link rel="prefetch" href="/GOFamily/assets/js/33.4d31d0db.js"><link rel="prefetch" href="/GOFamily/assets/js/34.7610889f.js"><link rel="prefetch" href="/GOFamily/assets/js/35.07f8b036.js"><link rel="prefetch" href="/GOFamily/assets/js/36.d1acb39c.js"><link rel="prefetch" href="/GOFamily/assets/js/37.1fac0e0a.js"><link rel="prefetch" href="/GOFamily/assets/js/38.53670642.js"><link rel="prefetch" href="/GOFamily/assets/js/39.9c8315fb.js"><link rel="prefetch" href="/GOFamily/assets/js/4.a73c4d70.js"><link rel="prefetch" href="/GOFamily/assets/js/40.c47687be.js"><link rel="prefetch" href="/GOFamily/assets/js/41.73deb46e.js"><link rel="prefetch" href="/GOFamily/assets/js/42.85cfacd9.js"><link rel="prefetch" href="/GOFamily/assets/js/43.1b441a63.js"><link rel="prefetch" href="/GOFamily/assets/js/44.5dc33e34.js"><link rel="prefetch" href="/GOFamily/assets/js/45.e7e66273.js"><link rel="prefetch" href="/GOFamily/assets/js/46.146ccd16.js"><link rel="prefetch" href="/GOFamily/assets/js/47.aa0964bb.js"><link rel="prefetch" href="/GOFamily/assets/js/48.0f67a15e.js"><link rel="prefetch" href="/GOFamily/assets/js/49.565c30a8.js"><link rel="prefetch" href="/GOFamily/assets/js/5.864fc44c.js"><link rel="prefetch" href="/GOFamily/assets/js/50.0f964c86.js"><link rel="prefetch" href="/GOFamily/assets/js/51.9dd5ff4a.js"><link rel="prefetch" href="/GOFamily/assets/js/52.d3f06485.js"><link rel="prefetch" href="/GOFamily/assets/js/53.60bb95e9.js"><link rel="prefetch" href="/GOFamily/assets/js/54.ee26f0f5.js"><link rel="prefetch" href="/GOFamily/assets/js/55.7b5dc58d.js"><link rel="prefetch" href="/GOFamily/assets/js/56.e3024720.js"><link rel="prefetch" href="/GOFamily/assets/js/57.74cebe2c.js"><link rel="prefetch" href="/GOFamily/assets/js/58.2eea170e.js"><link rel="prefetch" href="/GOFamily/assets/js/59.a733d97b.js"><link rel="prefetch" href="/GOFamily/assets/js/6.f4af1c68.js"><link rel="prefetch" href="/GOFamily/assets/js/60.31fce32e.js"><link rel="prefetch" href="/GOFamily/assets/js/61.025df443.js"><link rel="prefetch" href="/GOFamily/assets/js/62.dfeb9d10.js"><link rel="prefetch" href="/GOFamily/assets/js/63.088bb315.js"><link rel="prefetch" href="/GOFamily/assets/js/64.7503aa28.js"><link rel="prefetch" href="/GOFamily/assets/js/65.9e82002d.js"><link rel="prefetch" href="/GOFamily/assets/js/66.fd22a77b.js"><link rel="prefetch" href="/GOFamily/assets/js/67.613f77e3.js"><link rel="prefetch" href="/GOFamily/assets/js/68.42cf41b2.js"><link rel="prefetch" href="/GOFamily/assets/js/69.a1051de8.js"><link rel="prefetch" href="/GOFamily/assets/js/7.5c52a687.js"><link rel="prefetch" href="/GOFamily/assets/js/70.8c3a3873.js"><link rel="prefetch" href="/GOFamily/assets/js/71.57746954.js"><link rel="prefetch" href="/GOFamily/assets/js/72.5afe8bc8.js"><link rel="prefetch" href="/GOFamily/assets/js/73.03d8974c.js"><link rel="prefetch" href="/GOFamily/assets/js/74.4f1eeb3c.js"><link rel="prefetch" href="/GOFamily/assets/js/75.d44fc2e7.js"><link rel="prefetch" href="/GOFamily/assets/js/76.f53bf284.js"><link rel="prefetch" href="/GOFamily/assets/js/77.bad2588a.js"><link rel="prefetch" href="/GOFamily/assets/js/78.2ee31447.js"><link rel="prefetch" href="/GOFamily/assets/js/79.f5c3f20d.js"><link rel="prefetch" href="/GOFamily/assets/js/8.419c1695.js"><link rel="prefetch" href="/GOFamily/assets/js/80.5aa44af4.js"><link rel="prefetch" href="/GOFamily/assets/js/81.33455a03.js"><link rel="prefetch" href="/GOFamily/assets/js/82.9f2284bd.js"><link rel="prefetch" href="/GOFamily/assets/js/83.5dc60988.js"><link rel="prefetch" href="/GOFamily/assets/js/84.b93653e7.js"><link rel="prefetch" href="/GOFamily/assets/js/85.17171820.js"><link rel="prefetch" href="/GOFamily/assets/js/86.411754fa.js"><link rel="prefetch" href="/GOFamily/assets/js/87.94cb9c84.js"><link rel="prefetch" href="/GOFamily/assets/js/88.bf9b9181.js"><link rel="prefetch" href="/GOFamily/assets/js/89.30daa2d3.js"><link rel="prefetch" href="/GOFamily/assets/js/9.0852bf61.js"><link rel="prefetch" href="/GOFamily/assets/js/90.86c77607.js"><link rel="prefetch" href="/GOFamily/assets/js/91.77196b7c.js"><link rel="prefetch" href="/GOFamily/assets/js/92.52bff9af.js"><link rel="prefetch" href="/GOFamily/assets/js/93.2ad1e17b.js"><link rel="prefetch" href="/GOFamily/assets/js/94.cb498e95.js"><link rel="prefetch" href="/GOFamily/assets/js/95.3eff79bb.js"><link rel="prefetch" href="/GOFamily/assets/js/96.01bee062.js"><link rel="prefetch" href="/GOFamily/assets/js/97.46e63812.js"><link rel="prefetch" href="/GOFamily/assets/js/98.843925cf.js"><link rel="prefetch" href="/GOFamily/assets/js/99.d9206bf1.js">
    <link rel="stylesheet" href="/GOFamily/assets/css/0.styles.93ee3edc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/GOFamily/" class="home-link router-link-active"><img src="https://avatars.githubusercontent.com/u/42873232" alt="GOFamily - go ç¨‹åºå‘˜å®å…¸" class="logo"> <span class="site-name can-hide">GOFamily - go ç¨‹åºå‘˜å®å…¸</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/GOFamily/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Menu" class="dropdown-title"><span class="title">ç³»åˆ—æ•™ç¨‹</span> <span class="arrow down"></span></button> <button type="button" aria-label="Menu" class="mobile-dropdown-title"><span class="title">ç³»åˆ—æ•™ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/GOFamily/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GOFamily ã€goè¯­è¨€æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/408/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  408  ã€åŸºç¡€408çŸ¥è¯†æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/luban/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  luban  ã€ç³»ç»Ÿè®¾è®¡æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/dingdang/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  dingdang  ã€å·¥å…·æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/god/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  god  ã€ç»™ç¨‹åºå‘˜å†™çš„ä¹¦ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://shgopher.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä½œè€…
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/shgopher/GOFamily" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/GOFamily/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Menu" class="dropdown-title"><span class="title">ç³»åˆ—æ•™ç¨‹</span> <span class="arrow down"></span></button> <button type="button" aria-label="Menu" class="mobile-dropdown-title"><span class="title">ç³»åˆ—æ•™ç¨‹</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/GOFamily/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GOFamily ã€goè¯­è¨€æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/408/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  408  ã€åŸºç¡€408çŸ¥è¯†æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/luban/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  luban  ã€ç³»ç»Ÿè®¾è®¡æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/dingdang/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  dingdang  ã€å·¥å…·æ•™ç¨‹ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://shgopher.github.io/god/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  god  ã€ç»™ç¨‹åºå‘˜å†™çš„ä¹¦ã€‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://shgopher.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ä½œè€…
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/shgopher/GOFamily" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#åŸºç¡€ç”¨æ³•" class="sidebar-link">åŸºç¡€ç”¨æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#åˆ›å»º-channel" class="sidebar-link">åˆ›å»º channel</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channel-åˆ†ä¸ºä¸‰ç§ç±»å‹" class="sidebar-link">channel åˆ†ä¸ºä¸‰ç§ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å‘é€æ•°æ®" class="sidebar-link">å‘é€æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#æ¥æ”¶æ•°æ®" class="sidebar-link">æ¥æ”¶æ•°æ®</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å…³é—­-channel" class="sidebar-link">å…³é—­ channel</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#åˆ¤æ–­ä»-channel-ä¸­å–å‡ºçš„å€¼æ˜¯å¦æœ‰æ•ˆ" class="sidebar-link">åˆ¤æ–­ä» channel ä¸­å–å‡ºçš„å€¼æ˜¯å¦æœ‰æ•ˆ</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#range-channel" class="sidebar-link">range channel</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å…¶å®ƒæ“ä½œ-len-cap" class="sidebar-link">å…¶å®ƒæ“ä½œï¼šlen cap</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä¸åŒçŠ¶æ€-channel-çš„æ€»ç»“" class="sidebar-link">ä¸åŒçŠ¶æ€ channel çš„æ€»ç»“</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#select" class="sidebar-link">select</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å¯¹äº-select-for-time-sleep-çš„é˜»å¡æœºåˆ¶çš„ç†è§£" class="sidebar-link">å¯¹äº selectï¼Œforï¼Œtime.Sleep çš„é˜»å¡æœºåˆ¶çš„ç†è§£</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å®šæ—¶å™¨" class="sidebar-link">å®šæ—¶å™¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#cron-è§„åˆ™å®šæ—¶ä»»åŠ¡æ¡†æ¶-robfig-cron" class="sidebar-link">cron è§„åˆ™å®šæ—¶ä»»åŠ¡æ¡†æ¶ robfig/cron</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä½¿ç”¨åå°„æ‰§è¡ŒæœªçŸ¥æ•°é‡çš„-channel" class="sidebar-link">ä½¿ç”¨åå°„æ‰§è¡ŒæœªçŸ¥æ•°é‡çš„ channel</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#æ•°æ®äº¤æµ-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼" class="sidebar-link">æ•°æ®äº¤æµ---ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä¼ é€’ä¿¡å·-é€šçŸ¥" class="sidebar-link">ä¼ é€’ä¿¡å·/é€šçŸ¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#æ”¶å‘åŒæ—¶è¿›è¡Œçš„ä¿¡å·" class="sidebar-link">æ”¶å‘åŒæ—¶è¿›è¡Œçš„ä¿¡å·</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä½¿ç”¨è®¡æ—¶å™¨å»è§£å†³é•¿ç­‰å¾…é—®é¢˜" class="sidebar-link">ä½¿ç”¨è®¡æ—¶å™¨å»è§£å†³é•¿ç­‰å¾…é—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#shutdown-å’Œä¿¡å·ä¼ é€’ç»“åˆä¼˜é›…é€€å‡º" class="sidebar-link">shutdown å’Œä¿¡å·ä¼ é€’ç»“åˆä¼˜é›…é€€å‡º</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä¿¡å·ä¼ é€’ä¹‹-or-do-æ¨¡å¼" class="sidebar-link">ä¿¡å·ä¼ é€’ä¹‹ or-do æ¨¡å¼</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#é”" class="sidebar-link">é”</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ä»»åŠ¡ç¼–æ’" class="sidebar-link">ä»»åŠ¡ç¼–æ’</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#fan-in" class="sidebar-link">fan-in</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#fan-out" class="sidebar-link">fan-out</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#map-reduce" class="sidebar-link">map-reduce</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#pipeline-æµæ°´çº¿æ¨¡å¼" class="sidebar-link">pipeline-æµæ°´çº¿æ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#stream-æµæ¨¡å¼" class="sidebar-link">stream-æµæ¨¡å¼</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#pipeline-æµæ°´çº¿æ¨¡å¼å’Œ-stream-æµæ¨¡å¼çš„å¯¹æ¯”" class="sidebar-link">pipeline æµæ°´çº¿æ¨¡å¼å’Œ stream æµæ¨¡å¼çš„å¯¹æ¯”</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channel-æ³¨æ„äº‹é¡¹" class="sidebar-link">channel æ³¨æ„äº‹é¡¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#goroutine-æ³„éœ²" class="sidebar-link">goroutine æ³„éœ²</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channle-å’Œè¿è¡Œæ—¶è°ƒåº¦å¦‚ä½•äº¤äº’" class="sidebar-link">channle å’Œè¿è¡Œæ—¶è°ƒåº¦å¦‚ä½•äº¤äº’</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å¦‚æœå»æ‰-channel-goroutine-å°±å¯ä»¥çœŸå®çš„å¹¶è¡Œäº†å—" class="sidebar-link">å¦‚æœå»æ‰ channelï¼Œgoroutine å°±å¯ä»¥çœŸå®çš„å¹¶è¡Œäº†å—</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channel-åº•å±‚å®é™…ä¸Šæ˜¯äº’æ–¥é”-é˜»å¡æœºåˆ¶ä¹Ÿç¬¦åˆäº’æ–¥é”å¯¹äº-goroutine-çš„é˜»å¡è§„åˆ™å—" class="sidebar-link">channel åº•å±‚å®é™…ä¸Šæ˜¯äº’æ–¥é”ï¼Œé˜»å¡æœºåˆ¶ä¹Ÿç¬¦åˆäº’æ–¥é”å¯¹äº goroutine çš„é˜»å¡è§„åˆ™å—</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#issues" class="sidebar-link">issues</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channel-æ˜¯å¹¶å‘é“¶å¼¹å—" class="sidebar-link">channel æ˜¯å¹¶å‘é“¶å¼¹å—ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#æœ‰æ— -buffer-çš„-channel-åŒºåˆ«" class="sidebar-link">æœ‰æ—  buffer çš„ channel åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channel-close-å-read-write-close-çš„åŒºåˆ«" class="sidebar-link">channel close åï¼Œread write close çš„åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#channle-åº•å±‚æ˜¯ä»€ä¹ˆ" class="sidebar-link">channle åº•å±‚æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#ç¼–ç¨‹é¢˜-ä½¿ç”¨ä¸‰ä¸ª-goroutine-æ‰“å°-abc-100-æ¬¡" class="sidebar-link">ç¼–ç¨‹é¢˜ï¼Œä½¿ç”¨ä¸‰ä¸ª goroutine æ‰“å° abc 100 æ¬¡</a></li></ul></li><li><a href="/GOFamily/%E5%B9%B6%E5%8F%91/channel/#å‚è€ƒèµ„æ–™" class="sidebar-link">å‚è€ƒèµ„æ–™</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="channel">channel</h1> <p>channel æ˜¯ csp å¹¶å‘æ¨¡å‹ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå®Œæˆçš„ä½¿å‘½æ˜¯ goroutine ä¹‹é—´çš„é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯ csp ä¸­çš„ cã€‚</p> <p>channel æ˜¯ go è¯­è¨€è¯­è¨€çº§çš„çº¿ç¨‹å®‰å…¨çš„é€šä¿¡ç»„ä»¶ï¼Œå®ƒæ˜¯ go è¯­è¨€çš„ä¸€ä¸ªå†…ç½®ç±»å‹ï¼Œä¹Ÿå› æ­¤ go è¯­è¨€æ‰è¢«ç§°ä¹‹ä¸ºåœ¨è®¾è®¡ä¹‹åˆå°±è€ƒè™‘äº†å¹¶å‘çš„è¯­è¨€ã€‚</p> <p>go è¯­è¨€ä¹‹çˆ¶ rob pike æ›¾è¯´åˆ° â€œä¸è¦ä½¿ç”¨å…±äº«å†…å­˜çš„æ–¹å¼å»é€šä¿¡ï¼Œè€Œæ˜¯é€šè¿‡é€šä¿¡çš„æ–¹å¼å»å…±äº«å†…å­˜â€ è¿™å¥è¯å°±æ˜¯å½¢å®¹çš„ channelï¼Œè¿™å¥è¯çš„æ„æ€æ˜¯è¯´ï¼Œæˆ‘ä»¬æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºä¸åº”è¯¥é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼å»å®Œæˆè¿™ä¸ªå¹¶å‘æ“ä½œï¼Œå„ä¸ªçº¿ç¨‹åº”è¯¥å„è‡ªè¿è¡Œï¼Œäº’ä¸å¹²æ¶‰ï¼Œä½¿ç”¨é€šä¿¡çš„æ–¹å¼å»äº¤æµå»åˆ†äº«å†…å­˜ä¿¡æ¯å³å¯ã€‚</p> <h2 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</h2> <h3 id="åˆ›å»º-channel">åˆ›å»º channel</h3> <p>channel æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ª channel å¿…é¡»åˆ’å®šåº•å±‚å†…å­˜ç»™ channelï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ makeï¼Œä¸ä½¿ç”¨ make åªç”¨æ¥å£°æ˜çš„ channelï¼Œå…¶åˆå§‹å€¼å°±æ˜¯ nilï¼Œè¿™ä¸€ç‚¹è·Ÿå…¶å®ƒå¼•ç”¨ç±»å‹ï¼Œä¾‹å¦‚æ¥å£ï¼Œåˆ‡ç‰‡ï¼Œmap æ˜¯ä¸€è‡´çš„ã€‚</p> <p>å¯¹äº nil çš„ channelï¼Œå‘é€å’Œæ¥æ”¶æ•°æ®æ€»æ˜¯ä¼šé˜»å¡çš„ï¼Œå¯¹äº nil çš„ channelï¼Œå…³é—­å®ƒç›´æ¥ä¼š panic <code>panic: close of nil channel</code></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ªæ— ç¼“å­˜channel</span>
ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token comment">// åˆ›å»ºä¸€ä¸ªæœ‰ç¼“å­˜çš„channel</span>
ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><p>ä¸€ä¸ªæ— ç¼“å­˜çš„ channelï¼Œåªæœ‰æ¥æ”¶äº†æ•°æ®ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªæ•°æ®å¾€é€šé“ä¸­ï¼Œä¸€ä¸ªæœ‰ç¼“å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚è¿™é‡Œæ˜¯ 10ï¼Œé‚£ä¹ˆå¯ä»¥å¾€è¿™ä¸ª channel ä¸­å‘é€ 10 ä¸ªæ•°æ®ï¼Œå¹¶ä¸”ä¸éœ€è¦æ¥æ”¶ï¼Œåªæœ‰å‘é€ç¬¬åä¸€ä¸ªæ•°æ®çš„æ—¶å€™æ‰ä¼šå‘é€é˜»å¡ã€‚</p> <blockquote><p>å…³äº channel çš„å¤šçº¿ç¨‹è§„åˆ™ï¼Œè¯·å‚è€ƒ<a href="../%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">å†…å­˜æ¨¡å‹</a>è¿™ä¸€ç« èŠ‚</p></blockquote> <h3 id="channel-åˆ†ä¸ºä¸‰ç§ç±»å‹">channel åˆ†ä¸ºä¸‰ç§ç±»å‹</h3> <ul><li>åªèƒ½å‘é€çš„ channel <code>chan&lt;-</code></li> <li>åªèƒ½æ¥æ”¶çš„ channel <code>&lt;-chan</code></li> <li>å¯å‘å¯æ”¶çš„ channel <code>chan</code></li></ul> <p>channel é‡Œé¢ç†è®ºä¸Šå¯ä»¥å­˜åœ¨ä»»æ„çš„ç±»å‹æ•°æ®ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬ channel è‡ªå·±ï¼Œé‚£ä¹ˆå½“ channel ä¸­å‡ºç°äº†å¾ˆå¤šç¬¦å·æ—¶è¯¥å¦‚ä½•åŒºåˆ†å‘¢ï¼Ÿ</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span> 
</code></pre></div><p>è¿™é‡Œæœ‰ä¸ªè§„åˆ™ï¼Œç¬¦å·æ€»æ˜¯è·Ÿå·¦ä¾§çš„ chan åœ¨ä¸€èµ·è¡¨ç¤ºå«ä¹‰ï¼Œæ¯”å¦‚è¿™é‡Œï¼Œå°±æ˜¯ä¸€ä¸ªåªèƒ½å‘é€çš„ channelï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯ä¸€ä¸ª int ç±»å‹çš„ channel</p> <p>æˆ‘ä»¬çŸ¥é“ï¼Œchannel å¯ä»¥æ‹¥æœ‰ä¸‰ç§ä¸åŒçš„ç±»å‹ï¼Œèƒ½å‘èƒ½æ”¶çš„ channel æ˜¯æ»¡è¶³å‰ä¸¤è€…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ å£°æ˜çš„æ˜¯ä¸€ä¸ªåªèƒ½æ¥æ”¶çš„ channelï¼Œä½ å¯ä»¥ä¼ å…¥ä¸€ä¸ªèƒ½æ”¶èƒ½å‘çš„ channelï¼Œä½†å½“ä½ å£°æ˜çš„æ˜¯ä¸€ä¸ªèƒ½æ”¶ä¹Ÿèƒ½å‘çš„ channel æ—¶ï¼Œå°±ä¸èƒ½ä¼ é€’è¿›å»ä¸€ä¸ªåªèƒ½å‘æˆ–è€…åªèƒ½æ”¶çš„ channel</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">age</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span>c <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// âŒ </span>
<span class="token comment">// cannot use c (variable of type &lt;-chan int) as chan int value in argument to age</span>

<span class="token keyword">package</span> main

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token function">age</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span>c <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>æ‰€ä»¥ï¼Œé€šå¸¸æˆ‘ä»¬å®é™…ä½¿ç”¨å½“ä¸­éƒ½æ˜¯è¿™æ ·çš„åœºæ™¯ï¼ŒæŸä¸ªå‡½æ•°ä¸­çš„å‚æ•°æ˜¯ä¸€ä¸ªåªè¯»æˆ–è€…åªå‘çš„ä¸€ä¸ª channel ç±»å‹ï¼Œæˆ‘ä»¬ä¼ é€’è¿›å»çš„æ˜¯ä¸€ä¸ªèƒ½æ”¶èƒ½å‘çš„ channelã€‚</p> <p>å› ä¸ºæˆ‘ä»¬åœ¨å‡½æ•°çš„å‚æ•°ä¸­è¿™ä¹ˆè®¾ç½®æ˜¯ä¸ºäº†é¿å…ä½¿ç”¨ä¸­å‡ºç° bugï¼Œæ¯”å¦‚æŸä¸ªå‡½æ•°å®ƒå°±åªèƒ½æ”¶æ•°æ®ï¼Œæ‰€ä»¥ç»™å®šå®ƒçš„æ˜¯ä¸€ä¸ªåªèƒ½æ”¶çš„ channel éå¸¸åˆç†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆ›å»ºæ—¶è¦åˆ›å»ºä¸€ä¸ªèƒ½æ”¶ä¹Ÿèƒ½å‘çš„ channel å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ª channel å¿…å®šè¦åœ¨å…¶å®ƒçš„ goroutine ä¸­è¢«å‘é€æ•°æ®ï¼Œè¿™ä¸ªå…¶å®ƒ goroutine å‚æ•°å¯èƒ½è¢«è®¾ç½®ä¸ºåªèƒ½å‘é€ã€‚</p> <p>æ€»ç»“ä¸€ä¸‹ï¼Œè®¾ç½®åªèƒ½å‘æˆ–è€…åªèƒ½æ”¶çš„ channel æœ¬è´¨ä¸Šåªæ˜¯ä¸ºäº†é™åˆ¶å‡½æ•°çš„èƒ½åŠ›æ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„ bugï¼Œä½†æ˜¯ channel çš„æœ¬è´¨æˆ‘ä»¬è¿˜æ˜¯è¦æ¸…æ¥šçš„ï¼šåœ¨ä¸åŒçš„ goroutine ä¹‹é—´ä¼ é€’ä¿¡æ¯</p> <p>åŒæ—¶ï¼Œé™¤äº†ä¸Šé¢è¿™ä¸ªç¦å¿Œä¹‹å¤–ï¼Œ<strong>åªèƒ½æ”¶</strong>çš„ channel ä¸èƒ½ closeï¼Œä¸€æ—¦ close å°±ä¼š panicï¼Œä¸è¿‡åªèƒ½å‘çš„ channel å€’æ˜¯å¯ä»¥ close è¿™ä¸ªæ“ä½œ</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">//âŒ</span>
<span class="token comment">// invalid operation: cannot close receive-only channel c (variable of type &lt;-chan int)</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//âŒ </span>
<span class="token comment">//invalid operation: cannot close receive-only channel c (variable of type &lt;-chan int)</span>
<span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span>c <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// âœ…</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
	<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//âœ…</span>
<span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span>c <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å‘é€æ•°æ®">å‘é€æ•°æ®</h3> <div class="language-go extra-class"><pre class="language-go"><code>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
ch <span class="token operator">&lt;-</span> <span class="token number">12</span>
</code></pre></div><h3 id="æ¥æ”¶æ•°æ®">æ¥æ”¶æ•°æ®</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span>ch <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// æ¥æ”¶ä½†èˆå¼ƒæ•°å€¼</span>
  <span class="token comment">// &lt;- ch</span>
  
  <span class="token comment">// æ¥æ”¶å¹¶èµ‹å€¼</span>
  c <span class="token operator">:=</span> <span class="token operator">&lt;-</span> ch
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å…³é—­-channel">å…³é—­ channel</h3> <div class="language-go extra-class"><pre class="language-go"><code>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
</code></pre></div><h3 id="åˆ¤æ–­ä»-channel-ä¸­å–å‡ºçš„å€¼æ˜¯å¦æœ‰æ•ˆ">åˆ¤æ–­ä» channel ä¸­å–å‡ºçš„å€¼æ˜¯å¦æœ‰æ•ˆ</h3> <div class="language-go extra-class"><pre class="language-go"><code>v<span class="token punctuation">,</span>ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch

<span class="token keyword">if</span> ok <span class="token punctuation">{</span>
  <span class="token comment">// æ˜¯æœ‰æ•ˆå€¼</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token comment">//æ˜¯é›¶å€¼</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ok çš„å€¼è¡¨ç¤ºçš„æ˜¯ â€œæ¥æ”¶æ˜¯å¦ä¼šæˆåŠŸâ€ï¼Œè€Œä¸æ˜¯ channel æ˜¯å¦å·²å…³é—­</p> <p>å½“ channel å·²å…³é—­ä¸”æ•°æ®å·²å–å®Œï¼Œå†æ¥æ”¶æ—¶ ok ä¼šä¸º falseï¼Œè¡¨ç¤º â€œæ¥æ”¶ä¸ä¼šæˆåŠŸâ€</p> <p>ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿ channel å·²ç»å…³é—­ï¼Œå¦‚æœä¹‹å‰ channel ä¸­è¿˜æœ‰æ•°æ®æœªè¢«æ¶ˆè´¹ï¼Œé‚£ä¹ˆæ•°æ®ä¹Ÿèƒ½è¢«æ­£å¸¸çš„è¯»å–ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;fmt&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

	<span class="token comment">// å‘channelå‘é€3ä¸ªæ•°æ®</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ch <span class="token operator">&lt;-</span> <span class="token number">1</span>
		ch <span class="token operator">&lt;-</span> <span class="token number">2</span>
		ch <span class="token operator">&lt;-</span> <span class="token number">3</span>
		<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;å·²ç»å…³é—­äº†channelï¼Œå¹¶ä¸”æ²¡æœ‰å–å€¼&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token comment">// channelä¸­è¿˜æœ‰æœªæ¶ˆè´¹çš„æ•°æ®,å¯ä»¥æ­£å¸¸è¯»å–</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 1</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 2</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 3</span>
	<span class="token comment">// channelæ•°æ®å·²å–å®Œ,æ­¤æ—¶ä¼šç«‹å³å¾—åˆ°é›¶å€¼</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>ch<span class="token punctuation">)</span> <span class="token comment">// 0</span>
	<span class="token comment">// å†æ¬¡å…³é—­channelä¼španic</span>
	<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="range-channel">range channel</h3> <div class="language-go extra-class"><pre class="language-go"><code>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> ch<span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ª channel å¦‚æœæ²¡æœ‰è¢«å…³é—­ï¼Œé‚£ä¹ˆ range æ“ä½œå°†ä¼šä¸€ç›´é˜»å¡ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬éƒ½ä¼šå…³é—­è¿™ä¸ª channelï¼Œå¥½è®©ç¨‹åºç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æ§åˆ¶ channel çš„æ—¶å€™ï¼Œå°½å¯èƒ½çš„è¿˜æ˜¯è®©å‘é€æ–¹å»æ§åˆ¶ channel çš„å…³é—­ï¼Œä¸è¦åœ¨æ¥æ”¶æ–¹å»æ§åˆ¶ã€‚</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		wg1<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token function">close</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">defer</span> wg2<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> b <span class="token punctuation">{</span>
        <span class="token comment">//</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>  
</code></pre></div><p>æ³¨æ„çœ‹ï¼Œè¿™ä¸ªå…³é—­çš„æ“ä½œå…¶å®æ˜¯å¦èµ·äº†ä¸€ä¸ª goroutineï¼Œå› ä¸ºä½ ä¸ºäº† waitgroup çš„å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥ä½¿ç”¨æ–°çš„ goroutine å»å…³é—­ channel çš„æ“ä½œæ˜¯æ¯”è¾ƒå¸¸è§çš„åšæ³•ï¼Œä½ å¯ä»¥å‚è€ƒè¿™ä¸ª<a href="https://github.com/shgopher/collie" target="_blank" rel="noopener noreferrer">é¡¹ç›®<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="å…¶å®ƒæ“ä½œ-len-cap">å…¶å®ƒæ“ä½œï¼šlen cap</h3> <div class="language-go extra-class"><pre class="language-go"><code>ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// è·å–channelä¸­ç¼“å­˜çš„ä¸­è¿˜æœªè¢«å–èµ°çš„å…ƒç´ æ•°é‡</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// è·å–channelçš„å®¹é‡</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ä¸åŒçŠ¶æ€-channel-çš„æ€»ç»“">ä¸åŒçŠ¶æ€ channel çš„æ€»ç»“</h3> <table><thead><tr><th style="text-align:center;">çŠ¶æ€</th> <th style="text-align:center;">å‘é€æ•°æ®</th> <th style="text-align:center;">æ¥æ”¶æ•°æ®</th> <th style="text-align:center;">å…³é—­chan</th></tr></thead> <tbody><tr><td style="text-align:center;">æ­£å¸¸</td> <td style="text-align:center;">æ­£å¸¸</td> <td style="text-align:center;">æ­£å¸¸</td> <td style="text-align:center;">æ­£å¸¸</td></tr> <tr><td style="text-align:center;">nil</td> <td style="text-align:center;">é˜»å¡</td> <td style="text-align:center;">é˜»å¡</td> <td style="text-align:center;">panic</td></tr> <tr><td style="text-align:center;">closed</td> <td style="text-align:center;">panic</td> <td style="text-align:center;">æ­£å¸¸å€¼+é›¶å€¼</td> <td style="text-align:center;">panic</td></tr></tbody></table> <p>å¯¹äºæ­£å¸¸çš„ channelï¼Œå¦‚æœå®ƒæ²¡æœ‰ç¼“å­˜ï¼Œé‚£ä¹ˆè¯»å†™éƒ½ä¼šå‘ç”Ÿé˜»å¡ï¼Œé™¤éå¦ä¸€æ–¹å‡†å¤‡å¥½ï¼Œå¯¹äºæœ‰ buffer çš„ channelï¼Œå½“å®ƒè¿˜æœ‰ç¼“å­˜çš„æ—¶å€™ï¼Œéšæ„å‘é€æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™æ”¶å¯ä»¥ä¸å‡†å¤‡å¥½ï¼Œå½“ä»–æ»¡äº†ï¼Œå…¶å®è·Ÿæ²¡æœ‰ buffer çš„æ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè®¨è®ºäº†ï¼Œå¯ä»¥å»æŸ¥çœ‹<a href="/GOFamily/å¹¶å‘/å†…å­˜æ¨¡å‹/">å†…å­˜æ¨¡å‹</a>é‚£ä¸€ç« </p> <h2 id="select">select</h2> <p>select æ˜¯ go è¯­è¨€æä¾›çš„ï¼Œä¾› channel å»æ“ä½œçš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ch <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> ch1 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> ch2 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> i<span class="token operator">:=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;chè¢«å…³é—­äº†&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> ch1<span class="token operator">&lt;-</span> i<span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ch1 å‘é€æˆåŠŸ&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> v<span class="token punctuation">,</span>ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> ch2<span class="token punctuation">:</span>
        <span class="token keyword">if</span> ok <span class="token punctuation">{</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ch2 æ¥æ”¶åˆ°å€¼&quot;</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;chæ²¡æœ‰è¢«å…³é—­&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é¦–å…ˆï¼Œselect çš„ case ä¸­åªèƒ½å­˜æ”¾ channel çš„æ”¶å’Œå‘ï¼Œä»¥åŠä¸€ä¸ª default åˆ†æ”¯ï¼Œå„ä¸ªåˆ†æ”¯å¦‚æœåœ¨ç›¸åŒæ—¶é—´æ»¡è¶³äº†æ¡ä»¶æ˜¯ä¼šéšæœºå»èµ°åˆ†æ”¯çš„ï¼Œä¸å­˜åœ¨å…ˆåé¡ºåºï¼Œåœ¨ case éƒ½é˜»å¡çš„æƒ…å†µä¸‹å†å»èµ° defalut åˆ†æ”¯ï¼Œdefault åˆ†æ”¯çš„ä¼˜å…ˆçº§è¦ä½äº case åˆ†æ”¯ï¼Œæ‰€ä»¥ select ä¼šä¼˜å…ˆå»æ‰§è¡Œ case ä¸­çš„ send å’Œ receive æ“ä½œï¼Œå¦‚æœéƒ½æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆ select ä¼šéšæœºå»æ‰§è¡Œä¸€ä¸ª case åˆ†æ”¯ï¼Œå¦‚æœéƒ½ä¸å­˜åœ¨æ¡ä»¶ï¼Œé‚£ä¹ˆ select ä¼šå»æ‰§è¡Œ default åˆ†æ”¯ï¼Œå¦‚æœ default ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ select ä¼šé˜»å¡ã€‚</p> <p>åœ¨ select ä¸­ä¹Ÿæ˜¯å¯ä»¥å»åšåˆ¤æ–­çš„ï¼Œåˆ¤æ–­ channel æ˜¯å¦å­˜åœ¨æ­£å¸¸å€¼</p> <p>select æœ¬èº«ä¸å…·æœ‰å¾ªç¯æ€§è´¨ï¼Œæ‰€ä»¥é€šå¸¸è¢«é…åˆ for å¾ªç¯ä½¿ç”¨</p> <p>select åœ¨æ²¡æœ‰ä»»ä½• case çš„æ—¶å€™ä¼šé™·å…¥é˜»å¡ï¼Œæˆ‘ä»¬å¦‚æœå¸Œæœ›æœ‰ä¸€ä¸ªé˜»å¡å­˜åœ¨ï¼Œä½¿ç”¨ select æ˜¯æå¥½çš„ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//...</span>
<span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><h3 id="å¯¹äº-select-for-time-sleep-çš„é˜»å¡æœºåˆ¶çš„ç†è§£">å¯¹äº selectï¼Œforï¼Œtime.Sleep çš„é˜»å¡æœºåˆ¶çš„ç†è§£</h3> <p><em><strong>1ã€‚ä½¿ç”¨ for å¾ªç¯ä¸ä¼šé€ æˆ cpu çš„æ‰§è¡Œå—ï¼Ÿè¿˜æ˜¯è¯´ cpu é™·å…¥äº†ä¼‘çœ çŠ¶æ€ï¼Œtime.Sleep å‘¢ï¼Ÿ</strong></em></p> <p>ä½¿ç”¨ <code>for{}</code> å¾ªç¯ä¼šå¯¼è‡´ CPU é«˜é€Ÿç©ºè½¬ã€‚</p> <p>for å¾ªç¯æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¿™ç­‰å¾…/ç©ºè½¬ï¼ŒCPU ä¼šä¸€ç›´æ‰§è¡Œå¾ªç¯ä½“å†…å®¹ï¼Œåªä¸è¿‡è¿™é‡Œçš„å¾ªç¯ä½“ä¸ºç©ºï¼Œæ‰€ä»¥ CPU ä¼šä¸€ç›´ç©ºè½¬æµªè´¹èµ„æºã€‚</p> <p>ç›¸æ¯”è€Œè¨€ï¼Œtime.Sleep() ä¼š<strong>è®©å‡º CPU æ—¶é—´ç‰‡</strong>ï¼ŒæŠŠ goroutine æš‚åœä¸€æ®µæ—¶é—´ï¼Œåœ¨è¿™æ®µæ—¶é—´ CPU å¯ä»¥å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å½“ sleep æ—¶é—´ç»“æŸï¼Œgoroutine ä¼šé‡æ–°å¾—åˆ°æ—¶é—´ç‰‡ç»§ç»­æ‰§è¡Œã€‚</p> <p>æ‰€ä»¥ä»èµ„æºåˆ©ç”¨æ•ˆç‡æ¥è¯´ï¼Œtime.Sleep() æ˜æ˜¾ä¼˜äº for å¾ªç¯çš„ç©ºè½¬æ–¹å¼ã€‚</p> <p><em><strong>2ã€‚é‚£ä¹ˆ select {} å‘¢æ˜¯é«˜é€Ÿç©ºè½¬è¿˜æ˜¯è®©å‡ºèµ„æºå‘¢ï¼Ÿ</strong></em></p> <p>å½“ select é‡Œæ‰€æœ‰çš„ case éƒ½ä¸ ready æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾ CPU æ—¶é—´ç‰‡ï¼Œä½¿å½“å‰ goroutine è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè¿™å°±é¿å…äº†ç©ºè½¬ã€‚</p> <p><em><strong>3ã€‚select çš„ä¸åŒ caseï¼Œåœ¨ç­‰å¾… case ready çš„æ—¶å€™ï¼Œselect æ˜¯é è°ƒåº¦å™¨å»çœ‹ case æ˜¯å¦ ready è¿˜æ˜¯ä¸åœçš„è½®è¯¢å‘¢ï¼Ÿ</strong></em></p> <p>select å†…éƒ¨å®ç°äº†æ›´ç²¾å¯†çš„ç›‘å¬é€»è¾‘ï¼š</p> <ul><li>ä¸ºæ¯ä¸ª case çš„ channel è®¾ç½®ç›‘å¬å™¨</li> <li>å½“å‰ goroutine é˜»å¡æ—¶é‡Šæ”¾ CPU æ‰§è¡Œæƒ</li> <li>ç›‘å¬å™¨å¼‚æ­¥ç›‘æ§ channel çŠ¶æ€</li> <li>æœ‰ channel ready åˆ™å”¤é†’ goroutine</li></ul> <p>æ‰€ä»¥ select ä¸æ˜¯é€šè¿‡å¿™ç¢Œçš„è½®è¯¢æ¥åˆ¤æ–­ channel readyï¼Œè€Œæ˜¯é€šè¿‡å¼‚æ­¥ç›‘å¬çš„æ–¹å¼ï¼Œåªåœ¨å¿…è¦çš„æ—¶åˆ»å”¤é†’ goroutineã€‚</p> <p>è¿™ç§æ–¹å¼å¯ä»¥æå¤§åœ°å‡å°‘ CPU çš„å ç”¨ï¼Œæ•ˆç‡ä¹Ÿæ›´é«˜ã€‚</p> <p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¦‚æœä½ æƒ³è®¾ç½®ä¸€ä¸ªé˜»å¡æ—¶ï¼Œä½¿ç”¨ä¸€ä¸ªæ²¡æœ‰ case çš„ select æ˜¯æ¯”ä¸€ä¸ªç©º for å¾ªç¯æ›´å¥½çš„æ–¹æ³•ï¼Œå¦‚æœä½ æƒ³è®¾ç½®ä¸€ä¸ªæœ‰æ—¶é—´çš„é˜»å¡æ—¶ï¼Œä½¿ç”¨ time.Sleep æ— ç–‘æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ time.Sleep çš„ç²¾åº¦å¹¶ä¸é«˜ï¼Œç‰¹åˆ«é«˜ç²¾åº¦çš„é˜»å¡ä¸è¦ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œselect è®¾è®¡éå¸¸ç²¾å¦™ï¼Œåœ¨ç­‰å¾… case çš„æ—¶å€™å¹¶ä¸ä¼šå¤§é‡è€—è´¹ cpu çš„æ‰§è¡Œæ—¶é—´ï¼Œè€Œæ˜¯è®©å‡º cpu çš„æ‰§è¡Œç‰‡æ®µï¼Œè®¾ç½®ç›‘å¬ï¼Œå¼‚æ­¥çš„å»è·å–çŠ¶æ€ï¼Œæ‰€ä»¥ select çš„æ€§èƒ½æ˜¯éå¸¸ä¸é”™çš„</p> <h2 id="å®šæ—¶å™¨">å®šæ—¶å™¨</h2> <p>åœ¨ go è¯­è¨€ä¸­ï¼Œgo æä¾›äº†å®šæ—¶å™¨ç»™ç”¨æˆ·ï¼ŒåŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
      <span class="token comment">// åœ¨ä¸€ç§’åç»™caseå‘é€ä¿¡æ¯</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span>
    <span class="token comment">// å¿ƒè·³ä¿¡å·ï¼Œæ¯é—´éš”ä¸€ç§’å‘é€ä¸€æ¬¡ä¿¡æ¯</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é€šå¸¸æ¥è¯´ï¼Œè¿™æ˜¯ä¸ºäº†è¶…æ—¶è€Œå»è®¾ç½®çš„è·³å‡ºæœºåˆ¶</p> <h3 id="cron-è§„åˆ™å®šæ—¶ä»»åŠ¡æ¡†æ¶-robfig-cron">cron è§„åˆ™å®šæ—¶ä»»åŠ¡æ¡†æ¶ robfig/cron</h3> <p>robfig/cron æ˜¯ä¸€ä¸ª Go è¯­è¨€ç¼–å†™çš„ Cron è®¡åˆ’ä»»åŠ¡ç®¡ç†å™¨ã€‚</p> <p>è¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹åŒ…æ‹¬ï¼š</p> <ul><li>å®ç°äº† cron è§„èŒƒï¼Œå¯ä»¥åŸºäº cron è¡¨è¾¾å¼æ¥è°ƒåº¦ä»»åŠ¡</li> <li>æ”¯æŒåœ¨ä»£ç ä¸­ä»¥å£°æ˜å¼æ–¹å¼å®šä¹‰å®šæ—¶ä»»åŠ¡</li> <li>æ”¯æŒåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰å®šæ—¶ä»»åŠ¡</li> <li>æ”¯æŒä»»åŠ¡é“¾ï¼Œä¸€ä¸ªä»»åŠ¡å¯ä»¥è§¦å‘å…¶ä»–ä»»åŠ¡</li> <li>æ”¯æŒä»»åŠ¡é”ï¼Œé˜²æ­¢å¹¶å‘æ‰§è¡Œ</li> <li>æ”¯æŒå¤±è´¥é‡è¯•</li> <li>æœ‰é»˜è®¤çš„æ—¥å¿—è®°å½•å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¥å¿—è®°å½•å™¨</li> <li>è½»é‡çº§ï¼Œæ²¡æœ‰å¤–éƒ¨ä¾èµ–</li></ul> <p>robfig/cron å› ä¸ºå…¶ç®€å•ã€è½»é‡å’Œé«˜æ•ˆè€Œè¢«è®¸å¤š Go é¡¹ç›®ç”¨æ¥å®ç°å®šæ—¶ä»»åŠ¡ã€‚å®ƒå¯ä»¥ç”¨äºé¡¹ç›®ä¸­ä¸åŒç²’åº¦çš„è°ƒåº¦éœ€æ±‚ï¼Œå¦‚æ¯åˆ†é’Ÿæ‰§è¡Œã€æ¯å°æ—¶æ‰§è¡Œç­‰ã€‚</p> <p>ä¸‹é¢è§£é‡Šä¸€ä¸‹ cron æœºåˆ¶çš„å«ä¹‰ï¼š</p> <p>cron è¡¨è¾¾å¼è°ƒåº¦æ˜¯ cron ä½œä¸šè°ƒåº¦ç¨‹åºçš„æ ¸å¿ƒæœºåˆ¶ã€‚</p> <p>cron è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”± 5 æˆ– 6 ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„å­—æ®µç»„æˆï¼Œæ¯ä¸ªå­—æ®µè¡¨ç¤ºä¸€ä¸ªæ—¶é—´å•ä½ã€‚Cron ä¼šæ ¹æ®è¡¨è¾¾å¼ä¸­è®¾ç½®çš„å€¼ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹è§¦å‘ç›¸åº”çš„ä»»åŠ¡ã€‚</p> <p>cron è¡¨è¾¾å¼çš„å­—æ®µä¸æ„ä¹‰å¦‚ä¸‹ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code># æ–‡ä»¶æ ¼å¼èªªæ˜
# â”Œâ”€â”€åˆ†é’Ÿï¼ˆ<span class="token number">0</span> <span class="token operator">-</span> <span class="token number">59</span>ï¼‰
# â”‚ â”Œâ”€â”€å°æ—¶ï¼ˆ<span class="token number">0</span> <span class="token operator">-</span> <span class="token number">23</span>ï¼‰
# â”‚ â”‚ â”Œâ”€â”€æ—¥ï¼ˆ<span class="token number">1</span> <span class="token operator">-</span> <span class="token number">31</span>ï¼‰
# â”‚ â”‚ â”‚ â”Œâ”€æœˆï¼ˆ<span class="token number">1</span> <span class="token operator">-</span> <span class="token number">12</span>ï¼‰
# â”‚ â”‚ â”‚ â”‚ â”Œâ”€æ˜ŸæœŸï¼ˆ<span class="token number">0</span> <span class="token operator">-</span> <span class="token number">6</span>ï¼Œè¡¨ç¤ºä»å‘¨æ—¥åˆ°å‘¨å…­ï¼‰
# â”‚ â”‚ â”‚ â”‚ â”‚ â”Œâ”€å¹´ä»½ï¼ˆ <span class="token operator">*</span> è¡¨ç¤ºå…¨éƒ¨å¹´ä»½ï¼Œ<span class="token number">2024</span> è¡¨ç¤ºåªåœ¨<span class="token number">2024</span>å¹´ï¼‰
# â”‚ â”‚ â”‚ â”‚ â”‚ â”‚
# <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span>

# ä¾‹å¦‚
# <span class="token number">0</span> <span class="token number">0</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span>
# æ¯å¤© <span class="token number">12</span> ç‚¹è§¦å‘
</code></pre></div><p>æ¯ä¸ªå­—æ®µå¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦è¡¨ç¤ºå¤šç§æ—¶é—´è®¾ç½®ï¼š</p> <ul><li><code>*</code>ï¼šè¡¨ç¤ºåŒ¹é…è¯¥å­—æ®µçš„ä»»æ„å€¼</li> <li><code>,</code>ï¼šè¡¨ç¤ºåˆ†éš”å¤šä¸ªå€¼ï¼Œå¦‚åœ¨åˆ†é’Ÿå­—æ®µä½¿ç”¨ â€œ5,15,25â€ å°±è¡¨ç¤º5åˆ†ã€15åˆ†ã€25åˆ†éƒ½è§¦å‘</li> <li><code>-</code>ï¼šè¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œå¦‚åœ¨å°æ—¶å­—æ®µä½¿ç”¨ â€œ9-17â€ è¡¨ç¤º 9 ç‚¹åˆ° 17 ç‚¹ä¹‹é—´æ¯ä¸ªæ•´ç‚¹éƒ½è§¦å‘</li> <li><code>/</code>ï¼šè¡¨ç¤ºä¸€ä¸ªé—´éš”ï¼Œå¦‚åœ¨åˆ†é’Ÿå­—æ®µä½¿ç”¨ â€œ0/15â€ è¡¨ç¤ºæ¯15åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œä»0åˆ†å¼€å§‹</li> <li><code>?</code>ï¼šè¡¨ç¤ºä¸æŒ‡å®šçš„å€¼ï¼Œä¼šåŒ¹é…è¯¥å­—æ®µçš„ä»»æ„å€¼ã€‚</li></ul> <p>ä¸€äº›ä¾‹å­ï¼š</p> <ul><li><code>0 0 12 * * ?</code>ï¼šæ¯å¤© 12 ç‚¹è§¦å‘</li> <li><code>0 15 10 ? * *</code>ï¼šæ¯å¤© 10:15 è§¦å‘</li> <li><code>0 0/5 14 * * ?</code>ï¼šæ¯å¤© 14:00 åˆ° 14:55 æ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</li> <li><code>0 0/5 14,18 * * ?</code>ï¼šæ¯å¤© 14:00 åˆ° 14:55 å’Œ 18:00 åˆ° 18:55 æ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡</li></ul> <p>é€šè¿‡è¿™ç§è¡¨è¾¾å¼ï¼Œcron å¯ä»¥éå¸¸çµæ´»åœ°è®¾ç½®è§¦å‘æ—¶é—´è¡¨ï¼Œä»è€Œå®ç°å„ç§è°ƒåº¦éœ€æ±‚ã€‚</p> <p>ä¸‹é¢ç»™å‡ºè¿™ä¸ªé¡¹ç›®çš„ demoï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code>c <span class="token operator">:=</span> cron<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

<span class="token comment">// æ¯å°æ—¶çš„ç¬¬30åˆ†é’Ÿæ‰§è¡Œ</span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;30 * * * *&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¯å°æ—¶çš„ç¬¬30åˆ†é’Ÿ&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// åœ¨æ¯å¤©æ—©ä¸Š3ç‚¹åˆ°6ç‚¹,æ™šä¸Š8ç‚¹åˆ°11ç‚¹çš„èŒƒå›´å†…,æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡  </span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;30 3-6,20-23 * * *&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;åœ¨æ¯å¤©æ—©ä¸Š3ç‚¹åˆ°6ç‚¹,æ™šä¸Š8ç‚¹åˆ°11ç‚¹çš„èŒƒå›´å†…,æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment">// æ¯å¤©æ—©ä¸Šä¸œäº¬æ—¶é—´4ç‚¹30åˆ†æ‰§è¡Œä¸€æ¬¡</span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;CRON_TZ=Asia/Tokyo 30 04 * * *&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¯å¤©æ—©ä¸Šä¸œäº¬æ—¶é—´4ç‚¹30åˆ†æ‰§è¡Œä¸€æ¬¡&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä»ç°åœ¨èµ·æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡</span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;@hourly&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»ç°åœ¨èµ·æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä»ç°åœ¨èµ·æ¯éš”1å°æ—¶30åˆ†æ‰§è¡Œä¸€æ¬¡  </span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;@every 1h30m&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ä»ç°åœ¨èµ·æ¯éš”1å°æ—¶30åˆ†æ‰§è¡Œä¸€æ¬¡&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

c<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è¢«æ·»åŠ çš„å‡½æ•°ä¼šåœ¨è‡ªå·±çš„goroutineä¸­å¼‚æ­¥æ‰§è¡Œ</span>
<span class="token operator">...</span> 

<span class="token comment">// ä¹Ÿå¯ä»¥å‘å·²ç»å¯åŠ¨çš„Cronæ·»åŠ æ–°çš„å‡½æ•°</span>
c<span class="token punctuation">.</span><span class="token function">AddFunc</span><span class="token punctuation">(</span><span class="token string">&quot;@daily&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¯å¤©æ‰§è¡Œ&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// æ£€æŸ¥cronä»»åŠ¡ä¸‹æ¬¡å’Œä¸Šæ¬¡çš„æ‰§è¡Œæ—¶é—´</span>
<span class="token function">inspect</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token comment">// åœæ­¢è°ƒåº¦å™¨(å·²ç»å¯åŠ¨çš„ä»»åŠ¡ä¸ä¼šè¢«åœæ­¢)</span>
c<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ä½¿ç”¨åå°„æ‰§è¡ŒæœªçŸ¥æ•°é‡çš„-channel">ä½¿ç”¨åå°„æ‰§è¡ŒæœªçŸ¥æ•°é‡çš„ channel</h2> <p>å½“ä½ ä¸ç¡®å®šéœ€è¦å¤šå°‘ä¸ª channel å»å¤„ç†æ—¶ï¼Œä½ åªèƒ½é€‰æ‹©åœ¨è¿è¡Œæ—¶å»åˆ›å»ºæœªçŸ¥æ•°é‡çš„ channelï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨åå°„äº†ã€‚</p> <p>æˆ‘ä»¬ä½¿ç”¨ <code>reflect.Select(cases []reflect.SelectCase)(chosen int,recv reflect.Value,recvok bool)</code> å»å®ç° select</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// ä½¿ç”¨åå°„åˆ›å»ºçš„select</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ch1 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
	ch2 <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> cases <span class="token operator">=</span> <span class="token function">createSelectCase</span><span class="token punctuation">(</span>ch1<span class="token punctuation">,</span> ch2<span class="token punctuation">)</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token comment">// chosenï¼šchannel åˆ‡ç‰‡çš„ç´¢å¼•</span>
		<span class="token comment">// recvï¼šæ”¶åˆ°çš„å€¼</span>
		<span class="token comment">// okï¼šæ˜¯å¦æ˜¯é€šé“ä¸Šå‘é€çš„å€¼ï¼ˆè€Œä¸æ˜¯å› ä¸ºé€šé“å…³é—­è€Œæ¥æ”¶åˆ°çš„é›¶å€¼ï¼‰</span>
		<span class="token comment">// Selectæœ€å¤šæ”¯æŒ 65536 ä¸ªchannel</span>
		chosen<span class="token punctuation">,</span> recv<span class="token punctuation">,</span> ok <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>cases<span class="token punctuation">)</span>

		<span class="token keyword">if</span> recv<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æ”¶</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;recv:&quot;</span><span class="token punctuation">,</span> cases<span class="token punctuation">[</span>chosen<span class="token punctuation">]</span><span class="token punctuation">.</span>Dir<span class="token punctuation">,</span> recv<span class="token punctuation">,</span> ok<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// å‘</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;send:&quot;</span><span class="token punctuation">,</span> cases<span class="token punctuation">[</span>chosen<span class="token punctuation">]</span><span class="token punctuation">.</span>Dir<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">createSelectCase</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>SelectCase <span class="token punctuation">{</span>
	<span class="token keyword">var</span> cases <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>SelectCase

	<span class="token comment">// åˆ›å»º æ”¶ channel</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> ch <span class="token operator">:=</span> <span class="token keyword">range</span> chs <span class="token punctuation">{</span>
		cases <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cases<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>SelectCase<span class="token punctuation">{</span>
			Dir<span class="token punctuation">:</span>  reflect<span class="token punctuation">.</span>SelectRecv<span class="token punctuation">,</span>  <span class="token comment">// å‘ or æ”¶</span>
			Chan<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å…·ä½“ Channel</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// åˆ›å»º å‘ channel</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> ch <span class="token operator">:=</span> <span class="token keyword">range</span> chs <span class="token punctuation">{</span>
		cases <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cases<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>SelectCase<span class="token punctuation">{</span>
			Dir<span class="token punctuation">:</span>  reflect<span class="token punctuation">.</span>SelectSend<span class="token punctuation">,</span>  <span class="token comment">// å‘ or æ”¶</span>
			Chan<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å…·ä½“ channel</span>
			Send<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// å‘é€çš„å€¼</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> cases
<span class="token punctuation">}</span>


</code></pre></div><h2 id="æ•°æ®äº¤æµ-ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼">æ•°æ®äº¤æµ---ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼</h2> <p>è‘—åçš„ worker poolï¼Œå¦‚æœä½¿ç”¨ channel å»å®ç°çš„è¯ï¼Œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</p> <p>ä¸ºäº†ç»„æˆè¿™ä¸ªç»“æ„ï¼Œéœ€è¦ä¸€ä¸ªå­˜å‚¨ä»»åŠ¡çš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆè¿™é‡Œè‚¯å®šæ˜¯ä½¿ç”¨ä¸€ä¸ª channel</p> <p>åŸºæœ¬åŸç†å°±æ˜¯ï¼Œä¸€è¾¹å¾€ channel ä¸­å‘é€æ•°æ®ï¼Œä¸€è¾¹ä» channel ä¸­å–æ•°æ®ï¼Œç„¶åä½¿ç”¨å›ºå®šæ•°é‡çš„ goroutine å»æ¶ˆè´¹ channel ä¸­çš„æ•°æ®ï¼Œåˆšå¥½å½¢æˆä¸€ä¸ªå®Œæ•´çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œè¿™å°±æ˜¯å¤ç”¨ goroutine çš„æ¨¡å¼ã€‚</p> <p>å…·ä½“çš„é¢å¤–æ“ä½œè¿˜æœ‰æ§åˆ¶ worker æ•°é‡ï¼Œä»»åŠ¡æ”¾å…¥ woker æ± ï¼Œä»¥åŠä» woker æ± å–å‡ºä»»åŠ¡è¿™ä¸ªæ“ä½œ</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;context&quot;</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">,</span> cal <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">cal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">{</span>
				<span class="token keyword">select</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> c <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
					time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;é€€å‡º&quot;</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// å¾€ channel ä¸­ å‘é€æ•°æ®</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">{</span>
			ch <span class="token operator">&lt;-</span> <span class="token number">89</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>è¿™å°±æ˜¯åŸºæœ¬çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä»¥åŠ channel å»æ•°æ®äº¤æµçš„æœ€åŸºç¡€çš„åŸç†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªçœŸæ­£çš„å¯ç”¨çš„ worker pool</p> <p>ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„ worker pool ä¸ä»…éœ€è¦ä¸€ä¸ªä»»åŠ¡ channelï¼Œè¿˜éœ€è¦å­˜å‚¨ä»»åŠ¡ channel çš„ woker poolï¼Œè€Œè¿™ä¸ª woker pool æ˜¯ä¸€ä¸ª chan chan ç±»å‹</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> worker <span class="token keyword">struct</span> <span class="token punctuation">{</span>
   wokerPool <span class="token keyword">chan</span> <span class="token operator">*</span>worker
   jobChannel <span class="token keyword">chan</span> Job
<span class="token punctuation">}</span>
</code></pre></div><p>ä¹‹æ‰€ä»¥éœ€è¦ä¸€ä¸ª chan chan åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª chanï¼Œé‚£ä¹ˆ 10 å‡ ä¸ªå›ºå®šæ•°ç›®çš„ goroutine å°†ä¼šäº’æ–¥çš„è¯»å–ä¸€ä¸ª channel çš„æ•°æ®ï¼Œå¦‚æœæ˜¯ chan chan åˆ™äº’ä¸æ‰“æ‰°å„è‡ªè¯»å–è‡ªå·±çš„ channel å³å¯ã€‚</p> <p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šå°†è¯»å–çš„ channel å’Œå¤„ç†çš„ channel åˆ†å¼€ï¼Œè¯»å†™åˆ†ç¦»ï¼Œè¿›è¡Œè§£è€¦ï¼Œ
è¯»å–æ•°æ®çš„ channel åªéœ€è¦ä¸€ä¸ªå³å¯ï¼Œå¤„ç†çš„ channel å¯ä»¥æœ‰å¤šä¸ª</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span><span class="token punctuation">(</span>w <span class="token operator">*</span>worker<span class="token punctuation">)</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°† å•ä¸ªchannelï¼ˆå¯ä»¥ç®€å•çš„è¿™ä¹ˆè®¤ä¸ºä¸ºä¸€ä¸ª channelï¼‰ </span>
    <span class="token comment">// æ”¾å…¥ wokerPool ä¸­</span>
    <span class="token comment">// å¦‚æœ è¿™ä¸ª å•ä¸ªwokerï¼ˆè¿™é‡Œä»£è¡¨å•ä¸ªchannelï¼‰ä¸å†ä½¿ç”¨çš„è¯</span>
    w<span class="token punctuation">.</span>workerPool <span class="token operator">&lt;-</span> w
    <span class="token keyword">select</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> job <span class="token operator">:=</span> <span class="token operator">&lt;-</span> w<span class="token punctuation">.</span>jobChannel<span class="token punctuation">:</span> <span class="token comment">// ä»å•ä¸ªchannelä¸­è¯»å–æ•°æ®å¹¶å¤„ç†</span>
        <span class="token function">job</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>        
    <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»»åŠ¡åˆ†å‘çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä»è¯»å–çš„å•ä¸ª channel ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå‘é€ç»™å¤šä¸ªå¤„ç†ä»»åŠ¡çš„ channel</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> dispatcher <span class="token keyword">struct</span> <span class="token punctuation">{</span>
   workerPool <span class="token keyword">chan</span> <span class="token operator">*</span>worker
   OneChannel <span class="token keyword">chan</span> Job
<span class="token punctuation">}</span>
<span class="token keyword">func</span><span class="token punctuation">(</span>dispatcher <span class="token operator">*</span>dispatcher<span class="token punctuation">)</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> job <span class="token operator">:=</span> <span class="token operator">&lt;-</span> dispatcher<span class="token punctuation">.</span>OneChannel<span class="token punctuation">:</span> <span class="token comment">// ä»å•ä¸ªchannelä¸­è¯»å–æ•°æ®</span>
          <span class="token comment">// ä» wokerPool ä¸­è·å–ä¸€ä¸ªworker</span>
          work <span class="token operator">:=</span><span class="token operator">&lt;-</span> disatcher<span class="token punctuation">.</span>workerPool
          <span class="token comment">// ç»™è¿™ä¸ªworkerå‘é€ä»»åŠ¡</span>
          work<span class="token punctuation">.</span>jobChannel <span class="token operator">&lt;-</span> job
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">RunDispatcher</span><span class="token punctuation">(</span>workerPool <span class="token keyword">chan</span> <span class="token operator">*</span>workerPool<span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// å¯åŠ¨å›ºå®šæ•°ç›®çš„goroutineå»æ¶ˆè´¹ä»»åŠ¡ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªgoroutineæ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„channel</span>
   <span class="token keyword">for</span> i<span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token function">cap</span><span class="token punctuation">(</span>workerPool<span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span> <span class="token punctuation">{</span>
      worker <span class="token operator">:=</span> <span class="token function">newWorker</span><span class="token punctuation">(</span>workerPool<span class="token punctuation">)</span>
      worker<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// å¯åŠ¨åˆ†å‘å™¨</span>
   <span class="token keyword">go</span>  dispatcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¤§è‡´çš„è¿è¡Œè§„å¾‹å°±æ˜¯è¿™äº›ï¼Œå…¶å®ƒçš„å®Œæ•´åŠŸèƒ½è¯·æŸ¥çœ‹è¿™é‡Œï¼šhttps://github.com/shgopher/grpool</p> <h2 id="ä¼ é€’ä¿¡å·-é€šçŸ¥">ä¼ é€’ä¿¡å·/é€šçŸ¥</h2> <p>å½“ä½¿ç”¨ channel å»ä¼ é€’ä¿¡å·çš„ç”¨æ³•</p> <p>ä¾‹å¦‚ä½¿ç”¨ä¸€ä¸ª channel å»å……å½“ä¿¡å·é‡ï¼Œå½“ channel æ²¡æœ‰è¢«å…³é—­çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´é˜»å¡ï¼Œä¸€æ—¦ closedï¼Œé‚£ä¹ˆå°±èƒ½è¯»å–åˆ°æ•°æ®ï¼Œè‡ªç„¶å°±å®Œæˆäº†ä¿¡å·çš„ä¼ é€’ï¼Œè¿™ç§ç”¨æ³•éå¸¸å¸¸è§ï¼Œæ¯”å¦‚ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;-</span> ch
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™é‡Œä½¿ç”¨çš„ channel å°±æ˜¯å……å½“äº†ä¸€ä¸ªä¼ é€’ä¿¡å·çš„åŠŸèƒ½ã€‚ä¸€æ—¦ä¿¡å·ä¼ é€’è¿‡æ¥ï¼Œæ•´ä¸ªå‡½æ•°å°±å¯ä»¥ç»§ç»­è¿è¡Œä¸‹å»äº†ã€‚</p> <p>æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºçš„ç»“æ„ä½“è€Œä¸æ˜¯ç›´æ¥ close(ch)ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//...</span>
    ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;-</span> ch
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ”¶å‘åŒæ—¶è¿›è¡Œçš„ä¿¡å·">æ”¶å‘åŒæ—¶è¿›è¡Œçš„ä¿¡å·</h3> <p>ä½ ä¹Ÿå¯èƒ½è§è¿‡è¿™ç§è¡¨ç°æ–¹å¼ï¼Œå½“ channel å……å½“ä¿¡å·çš„æ—¶å€™ï¼Œå‘å’Œæ”¶åŒæ—¶è¿›è¡Œï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>w<span class="token punctuation">.</span>stop<span class="token punctuation">:</span> <span class="token comment">// B</span>
				w<span class="token punctuation">.</span>stop <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// C</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// å¦ä¸€æ®µä»£ç </span>
	w<span class="token punctuation">.</span>stop <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// A</span>
	<span class="token operator">&lt;-</span>w<span class="token punctuation">.</span>stop             <span class="token comment">// D</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å…ˆè¯´ç»“è®ºï¼Œè¿™ç§ç”¨æ³•æä¾›äº†ä¸¤ä¸ªæ„æ€ï¼Œæä¾›ä¿¡å·+åˆ¤æ–­æ˜¯å¦è¿è¡Œå®Œæ¯•</p> <p>A ä»£ç ç­‰ B å‡†å¤‡å¥½ä¹‹åï¼Œå‘é€äº†ä¿¡å·ï¼›
B ä»£ç æ¥å—åˆ°äº†ä¿¡å·ï¼Œè¿™ç®—å®Œæˆäº†ç¬¬ä¸€ä¸ªå«ä¹‰ï¼Œæä¾›ä¿¡å·</p> <p>C ä»£ç ç­‰ D ä»£ç å‡†å¤‡å®Œæ¯•ï¼Œå‘é€äº†ä¿¡å·ï¼ŒD æ¥å—å®Œæ¯•ï¼Œè¿™ä¸ªè¡¨ç¤º A é€šçŸ¥ B å¹²çš„äº‹å„¿ï¼Œåœ†æ»¡å®Œæˆï¼Œè¿™é‡Œæ˜¯è¡¨ç¤ºåˆ¤æ–­æ˜¯å¦æ‰§è¡Œå®Œæ¯•</p> <h3 id="ä½¿ç”¨è®¡æ—¶å™¨å»è§£å†³é•¿ç­‰å¾…é—®é¢˜">ä½¿ç”¨è®¡æ—¶å™¨å»è§£å†³é•¿ç­‰å¾…é—®é¢˜</h3> <p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éƒ½æ˜¯å¸Œæœ›ç¨‹åºæ‰§è¡Œå®Œæ¯•ä¹‹åè‡ªå·±ä¸»åŠ¨é€€å‡ºï¼Œæ¯”å¦‚ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    time<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
    <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;-</span> ch
<span class="token punctuation">}</span>
</code></pre></div><p>å¾ˆåˆç†ï¼Œä¸€èˆ¬æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå°±ä¼šé€šçŸ¥ä¸» goroutine ä¼˜é›…é€€å‡ºï¼Œä½†æ˜¯å¦‚æœæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½å°±ä¼šå¤±å»ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬å†è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´æ›´åŠ ä¼˜é›…çš„é€€å‡º</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;å¤„ç†è¶…æ—¶&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="shutdown-å’Œä¿¡å·ä¼ é€’ç»“åˆä¼˜é›…é€€å‡º">shutdown å’Œä¿¡å·ä¼ é€’ç»“åˆä¼˜é›…é€€å‡º</h3> <p>Shutdown æ–¹æ³•é€šå¸¸ä¸ä¿¡å·å¤„ç†ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨æ¥æ”¶åˆ°ç³»ç»Ÿé€€å‡ºä¿¡å· (å¦‚ SIGTERM æˆ– SIGINT) æ—¶ä¼˜é›…åœ°å…³é—­æœåŠ¡å™¨ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œéƒ½èƒ½å®Œæˆï¼Œè€Œä¸æ˜¯çªç„¶ä¸­æ–­ï¼Œä»è€Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</p> <p>è¿™ä¸ªæ–¹æ³•å…è®¸ä½ å®‰å…¨åœ°åœæ­¢æœåŠ¡å™¨ï¼Œè€Œä¸ä¼šä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚</p> <p>Shutdown æ–¹æ³•çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p> <ul><li><p>å…³é—­ç›‘å¬å™¨ï¼šé¦–å…ˆï¼Œå®ƒä¼šå…³é—­æ‰€æœ‰æ‰“å¼€çš„ç›‘å¬å™¨ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å°†ä¸å†æ¥å—æ–°çš„è¿æ¥è¯·æ±‚ã€‚</p></li> <li><p>å¤„ç†ç°æœ‰è¿æ¥ï¼šç„¶åï¼Œå®ƒä¼šç­‰å¾…æ‰€æœ‰ç°æœ‰çš„è¿æ¥ (å¦‚ HTTP è¯·æ±‚) å®Œæˆå¤„ç†ã€‚è¿™åŒ…æ‹¬é‚£äº›æ­£åœ¨å¤„ç†ä¸­çš„è¯·æ±‚ï¼Œä»¥åŠé‚£äº›å·²ç»å®Œæˆä½†å°šæœªå…³é—­çš„è¿æ¥ã€‚</p></li> <li><p>ä¸Šä¸‹æ–‡ç®¡ç†ï¼šShutdown æ–¹æ³•æ¥å—ä¸€ä¸ª context.Context å‚æ•°ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å¯ä»¥ç”¨æ¥è®¾ç½®è¶…æ—¶ã€‚å¦‚æœä¸Šä¸‹æ–‡åœ¨æœåŠ¡å™¨å…³é—­å®Œæˆä¹‹å‰è¢«å–æ¶ˆ (ä¾‹å¦‚ï¼Œå› ä¸ºè¶…æ—¶)ï¼ŒShutdown æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p></li> <li><p>ä¸å¤„ç†é•¿è¿æ¥ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒShutdown æ–¹æ³•ä¸ä¼šå°è¯•å…³é—­é‚£äº›é•¿æ—¶é—´ä¿æŒè¿æ¥çš„è¿æ¥ï¼Œå¦‚ WebSocketsã€‚å¯¹äºè¿™ç±»è¿æ¥ï¼Œä½ éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ³¨å†Œä¸€ä¸ªå…³é—­é€šçŸ¥å‡½æ•°ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ‰‹åŠ¨é€šçŸ¥è¿™äº›è¿æ¥å…³é—­ã€‚</p></li> <li><p>æœåŠ¡å™¨ä¸å¯é‡ç”¨ï¼šä¸€æ—¦è°ƒç”¨äº† Shutdownï¼ŒæœåŠ¡å™¨å°±ä¸èƒ½å†è¢«é‡ç”¨äº†ã€‚å°è¯•å†æ¬¡è°ƒç”¨ Serveã€ListenAndServe æˆ– ListenAndServeTLS æ–¹æ³•å°†è¿”å› ErrServerClosed é”™è¯¯ã€‚</p></li></ul> <p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š</p> <p>æœ‰ä¸¤ä¸ª listenAndServe æœåŠ¡ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ debug æœåŠ¡ä¸€ä¸ªæ˜¯æ­£å¼æœåŠ¡</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   done <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
   stop <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

   <span class="token comment">// ä½¿ç”¨æ–¹å»æ§åˆ¶æœåŠ¡çš„å…³é—­</span>
   <span class="token comment">// ä½¿ç”¨æ–¹æ§åˆ¶å¹¶å‘çš„æ“ä½œ</span>
   <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	done <span class="token operator">&lt;-</span> <span class="token function">serveDubug</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	done <span class="token operator">&lt;-</span> <span class="token function">serveApp</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

   <span class="token keyword">var</span> stopped <span class="token builtin">bool</span>

   <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">cap</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span> done<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">{</span>
   		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
   	<span class="token punctuation">}</span>
   	<span class="token keyword">if</span> <span class="token operator">!</span>stopped <span class="token punctuation">{</span>
   		stopped <span class="token operator">=</span> <span class="token boolean">true</span>
   		<span class="token function">close</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// çœç•¥</span>
<span class="token comment">//func serveDubug(){serve()}</span>
<span class="token comment">//func serveApp(){serve()}</span>

<span class="token keyword">func</span> <span class="token function">serve</span><span class="token punctuation">(</span>addr <span class="token builtin">string</span><span class="token punctuation">,</span>handler http<span class="token punctuation">.</span>Handler<span class="token punctuation">,</span>stop <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token builtin">error</span> <span class="token punctuation">{</span>
   s <span class="token operator">:=</span> http<span class="token punctuation">.</span>Server<span class="token punctuation">{</span>
   	Addr<span class="token punctuation">:</span> addr<span class="token punctuation">,</span>
   	Handler<span class="token punctuation">:</span> handler<span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// ä¿¡å·ä¼ é€’å’Œå…³é—­æœåŠ¡ç»“åˆ</span>
   <span class="token comment">// è¿™é‡Œä¸èƒ½ä½¿ç”¨ os.Exit()</span>
   <span class="token comment">// os.exit ä¼šç«‹åˆ»å…¨éƒ¨åœæ­¢ï¼Œä¸ä¼˜é›…ï¼Œæ¯”è¾ƒæš´åŠ›</span>
   <span class="token comment">// log.Fetal è¿™ä¸ªå‡½æ•°é€šå¸¸ä¸è¦ä½¿ç”¨ï¼Œå› ä¸ºå®ƒçš„åº•å±‚è°ƒç”¨çš„å°±æ˜¯os.Exit()</span>
   <span class="token comment">// å¦‚æœè¦æ˜¯ä½¿ç”¨è¿™ä¸ª log.Fetal å‡½æ•°ï¼Œåªç”¨åœ¨ç¨‹åºçš„èµ·å§‹ä½ç½®ï¼Œæ¯”å¦‚mainçš„å¼€å¤´ï¼Œæˆ–è€…initå‡½æ•°ä¸­</span>
   <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   	<span class="token operator">&lt;-</span> stop
   	s<span class="token punctuation">.</span><span class="token function">Shutdown</span><span class="token punctuation">(</span>contex<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ä¿¡å·ä¼ é€’ä¹‹-or-do-æ¨¡å¼">ä¿¡å·ä¼ é€’ä¹‹ or-do æ¨¡å¼</h3> <p>channel ä¿¡å·ä¼ é€’ä¹‹ or-do æ¨¡å¼è·Ÿ go å¹¶å‘åŸè¯­çš„ <a href="/GOFamily/å¹¶å‘/åŒæ­¥åŸè¯­/#singleflight">singleflight</a> æ¯”è¾ƒç±»ä¼¼</p> <p>åŒºåˆ«æ˜¯ï¼Œchannel çš„ or-do æ˜¯å¤šä¸ªä¿¡å·ä¼ é€’ï¼Œåªæœ‰ä¸€ä¸ª channel è·å–ä¿¡å·ä¹‹åå°±å¯ä»¥åœæ­¢å…¶å®ƒ channel äº†ï¼Œå¹¶ä¸éœ€è¦å°†è¿™ä¸ªä¿¡å·ä¼ é€’ç»™å…¶å®ƒçš„ channelï¼Œsingleflight æ˜¯éœ€è¦åˆ†äº«æƒ…æŠ¥çš„ã€‚</p> <p>ä¸‹é¢æœ‰ä¸¤ç§å®ç°çš„æ–¹å¼ï¼Œé€’å½’å’Œåå°„ï¼Œé€’å½’æ¯”è¾ƒé€‚åˆé€’å½’æ ‘è¾ƒä½çš„åœºæ™¯ï¼Œåå°„å°±é€‚åˆäº†é€’å½’æ ‘æ›´é«˜çš„åœºæ™¯ï¼Œå› ä¸ºå¦‚æœé€’å½’è¿‡æ·±çš„è¯å¾ˆå®¹æ˜“å‡ºç°å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå¦‚æœä½ è®¤ä¸ºä½ é¡¹ç›®ä¸­çš„ goroutine ä¹Ÿå°±å‡ åé‚£ä¹ˆé€’å½’å°±å¯ä»¥äº†ï¼Œæ¯•ç«Ÿåå°„å¯æ˜¯å¾ˆæµªè´¹æ‰§è¡Œæ—¶é—´çš„ï¼Œå¦‚æœ goroutine æˆåƒä¸Šä¸‡ï¼Œé€‰ç”¨åå°„å³å¯ã€‚</p> <p>ä½¿ç”¨é€’å½’çš„æ–¹æ³•ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token function">Ordo</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	<span class="token comment">// é€’å½’é€€å‡ºæ¡ä»¶</span>
	<span class="token keyword">switch</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	or <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>or<span class="token punctuation">)</span>
		<span class="token keyword">switch</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>chs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
			<span class="token punctuation">}</span>
		<span class="token keyword">default</span><span class="token punctuation">:</span>
			mi <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span><span class="token function">Ordo</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span><span class="token punctuation">:</span>mi<span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span><span class="token function">Ordo</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span>mi<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> or
<span class="token punctuation">}</span>
</code></pre></div><p>ä½¿ç”¨åå°„çš„æ–¹å¼ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token function">Ordo1</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	<span class="token comment">// é€’å½’é€€å‡ºæ¡ä»¶</span>
	<span class="token keyword">switch</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
	or <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>or<span class="token punctuation">)</span>
		<span class="token keyword">var</span> cases <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>SelectCase
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> chs <span class="token punctuation">{</span>
			cases <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cases<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>SelectCase<span class="token punctuation">{</span>
				Dir<span class="token punctuation">:</span>  reflect<span class="token punctuation">.</span>SelectRecv<span class="token punctuation">,</span>
				Chan<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>

			reflect<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>cases<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> or
<span class="token punctuation">}</span>
</code></pre></div><p>å¼€å§‹æµ‹è¯•ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">&quot;time&quot;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// output: 7</span>
  start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">&lt;-</span><span class="token function">Ordo</span><span class="token punctuation">(</span><span class="token function">sig</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sig</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sig</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">sig</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> ch
<span class="token punctuation">}</span>

</code></pre></div><p>æµ‹è¯•è¯æ˜è¿™ä¸¤ç§æ–¹æ³•å‡å¯å®ç° or-do ä¿¡å·é€šçŸ¥æ¨¡å¼ï¼Œä¸è¿‡å°±æˆ‘çœ‹æ¥ï¼Œåå°„çš„è¿™ç§æ–¹æ³•ï¼Œå®Œå…¨æ— è„‘ï¼Œä¹Ÿä¸ç”¨è€ƒè™‘é€’å½’ï¼Œä¹Ÿä¸å¿…å»è€ƒè™‘é€’å½’å¯¼è‡´çš„å†…å­˜æº¢å‡ºï¼Œä»å®ç°é€»è¾‘ä¸Šï¼Œéå¸¸çš„æ¸…æ™°ï¼Œåªéœ€è¦ç»„æˆä¸€ä¸ª select éšä¾¿ case å³å¯ï¼Œéå¸¸æ¸…æ™°ï¼Œæˆ‘é¦–æ¨è¿™ç§å®ç°æ–¹æ³•</p> <h2 id="é”">é”</h2> <p>æˆ‘ä»¬ä¸ä»…å¯ä»¥ä½¿ç”¨ sync.Mutext å»å®ç°äº’æ–¥é”ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ channel å»åšé”ï¼Œé”æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå…¶å®å°±æ˜¯ä¸€ç§ä¿¡å·é‡ï¼Œæ ‡å‡†çš„ pv æ“ä½œï¼Œp å‡å°‘æ•°æ®ï¼Œè·å–åˆ°é”ï¼Œv å¢åŠ æ•°æ®é‡Šæ”¾æ‰é”ï¼Œé”æ˜¯ä¸€ç§äºŒè¿›åˆ¶ä¿¡å·é‡</p> <p>åˆšå¥½ï¼Œchannel çš„æ”¶å‘å°±ç¬¦åˆä¿¡å·é‡çš„æŒ‡å¾</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> lock <span class="token keyword">struct</span> <span class="token punctuation">{</span>
   ch <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span><span class="token punctuation">(</span>l <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token operator">&lt;-</span> l<span class="token punctuation">.</span>ch 
<span class="token punctuation">}</span>
<span class="token keyword">func</span><span class="token punctuation">(</span>l <span class="token operator">*</span>lock<span class="token punctuation">)</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   l<span class="token punctuation">.</span>ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>lock<span class="token punctuation">)</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>l<span class="token punctuation">.</span>ch<span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>lock<span class="token punctuation">)</span> <span class="token function">tryLockeTimeout</span><span class="token punctuation">(</span>timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token keyword">select</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>l<span class="token punctuation">.</span>ch<span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span>
	<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
	
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">NewLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>lock<span class="token punctuation">{</span>
  l<span class="token operator">:=</span> <span class="token operator">&amp;</span>lock<span class="token punctuation">{</span>
    ch<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  l<span class="token punctuation">.</span>ch <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">return</span> l
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨åˆå§‹é˜¶æ®µï¼Œç»™äºˆä¸€ä¸ªæ‹¥æœ‰ä¸€ä¸ªç¼“å­˜çš„ channel ä¸€ä¸ªæ•°æ®ï¼Œè·å–é”å°±æ˜¯å°†è¿™ä¸ªæ•°æ®å–å‡ºæ¥ï¼Œé‡Šæ”¾é”å°±æ˜¯å°†è¿™ä¸ªæ•°æ®æ”¾å› channelï¼Œè¿™æ ·å°±å®ç°äº†ä¿¡å·é‡ä»¥åŠäº’æ–¥é”</p> <p>é‚£ä¹ˆè®©æˆ‘ä»¬è¯•ä¸€ä¸‹æˆ‘ä»¬è‡ªå·±å®ç°çš„äº’æ–¥é”ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	l <span class="token operator">:=</span> <span class="token function">NewLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	value <span class="token operator">:=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">120</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>

		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			l<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			value<span class="token operator">++</span>
			l<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token comment">// 120</span>
</code></pre></div><h2 id="ä»»åŠ¡ç¼–æ’">ä»»åŠ¡ç¼–æ’</h2> <h3 id="fan-in">fan-in</h3> <p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯ â€œå¤šä¸ªè¿›ï¼Œå•ä¸ªå‡ºâ€ï¼Œè¿™æ˜¯æ•°å­—ç”µè·¯çš„ä¸€ä¸ªæ¦‚å¿µï¼Œåœºæ™¯æ˜¯ï¼Œå¤šä¸ª channel å‘é€æ•°æ®ç»™ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œæ­¤å‡½æ•°è¿”å›ä¸€ä¸ª channel å»æ‰¿è½½ä¼—å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦ç›‘å¬æœ€åè¾“å‡ºçš„ channel å°±å¯ä»¥è¾¾åˆ°ç›‘å¬ä¼—å¤šä¿¡æ¯çš„ç›®çš„ã€‚</p> <p>åŸºæœ¬æ ·è²Œå¦‚ä¸‹ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">fanin</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»è¿™ä¸ªåŸºæœ¬æ„å‹ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬è¦åœ¨å‡½æ•°ä¸­å¤„ç†å¤šä¸ª channelï¼Œè¿™è·Ÿä¸Šæ–‡ channel ä¼ é€’ä¿¡å·çš„ or-do æ¨¡å¼ç±»ä¼¼ï¼Œæ‰€ä»¥å…ä¸äº†æˆ‘ä»¬è¦ä½¿ç”¨åå°„æˆ–è€…é€’å½’çš„æ–¹å¼å»å¤„ç†å‡½æ•°ï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨é€’å½’çš„æ–¹å¼å»å®ç°è¿™ä¸ªåŠŸèƒ½</p> <p>é€’å½’ç‰ˆ <code>fan-in</code>ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">fanin</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
		<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">return</span> c
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> chs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		m <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>chs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
		<span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">fanin</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span><span class="token punctuation">:</span>m<span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fanin</span><span class="token punctuation">(</span>chs<span class="token punctuation">[</span>m<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">merge</span><span class="token punctuation">(</span>ch1<span class="token punctuation">,</span> ch2 <span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">for</span> ch1 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">||</span> ch2 <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> v1<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch1<span class="token punctuation">:</span>
				<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
					ch1 <span class="token operator">=</span> <span class="token boolean">nil</span>
					<span class="token keyword">continue</span>
				<span class="token punctuation">}</span>
				c <span class="token operator">&lt;-</span> v1
			<span class="token keyword">case</span> v2<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch2<span class="token punctuation">:</span>
				<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
					ch2 <span class="token operator">=</span> <span class="token boolean">nil</span>
					<span class="token keyword">continue</span>
				<span class="token punctuation">}</span>
				c <span class="token operator">&lt;-</span> v2
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><p>åå°„ç‰ˆ <code>fan-int</code>ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">fanintflect</span><span class="token punctuation">(</span>chs <span class="token operator">...</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>

		<span class="token keyword">var</span> cases <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>SelectCase

		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vl <span class="token operator">:=</span> <span class="token keyword">range</span> chs <span class="token punctuation">{</span>
			cases <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cases<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>SelectCase<span class="token punctuation">{</span>
				Dir<span class="token punctuation">:</span>  reflect<span class="token punctuation">.</span>SelectRecv<span class="token punctuation">,</span>
				Chan<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>vl<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token function">len</span><span class="token punctuation">(</span>cases<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			i<span class="token punctuation">,</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>cases<span class="token punctuation">)</span>
			<span class="token comment">// ä» cases å–æ•°æ®ï¼Œä¸€æ—¦å–å®Œï¼Œcases ä¼šå–æ¶ˆå·²ç»å–å®Œçš„ case</span>
			<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
				cases <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cases<span class="token punctuation">[</span><span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> cases<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">...</span><span class="token punctuation">)</span>
				<span class="token keyword">continue</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// out å‘é€æ•°æ®</span>
			out <span class="token operator">&lt;-</span> v<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre></div><p>åå°„ç‰ˆæœ¬è¿™é‡Œæœ‰ä¸ªå°é—®é¢˜ï¼Œä» cases ä¸­å–å‡ºæ•°æ®ï¼Œå¾€ out ä¸­æ·»åŠ ï¼Œè¿™ä¸ªæ“ä½œåªèƒ½ä¸€ä¸ª case ä¸€ä¸ª case çš„å–ï¼Œä½†æ˜¯ä½ å¦‚æœè§‚å¯Ÿä¸Šæ–‡çš„é€’å½’å®ç°æ¨¡å¼ï¼Œä½ ä¼šå‘ç°å®ƒå¼€å¯äº†å¾ˆå¤š goroutine æ‰€ä»¥æ˜¯å¹¶å‘çš„å»å–æ•°æ®å¾€ out ä¸­é€ã€‚</p> <h3 id="fan-out">fan-out</h3> <p>fan out è·Ÿ fan in æ¨¡å¼æ˜¯ç›¸åçš„ï¼Œfan out æŒ‡çš„æ˜¯æ‹¥æœ‰ä¸€ä¸ªè¾“å…¥æºï¼Œå¤šä¸ªè¾“å‡ºæºï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ç§å¹¿æ’­æœºåˆ¶ï¼Œè¯»å–ä¸€ä¸ªæ•°æ®ï¼Œå¹¿æ’­ç»™ä¼—å¤šæ¥å—è€…ã€‚</p> <p>ä¸‹é¢çœ‹ä¸€ä¸‹ä»£ç ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">fanout</span><span class="token punctuation">(</span>value <span class="token keyword">chan</span> any<span class="token punctuation">,</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span> async <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				<span class="token function">close</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// å¯¹ä¸€ä¸ªnilçš„é€šé“è¿›è¡Œ for range éå†ä¼šå¯¼è‡´é˜»å¡(block)ã€‚</span>
		<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> value <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vi <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				vi <span class="token operator">:=</span> vi <span class="token comment">// if go version is lower then 1.22</span>
				<span class="token keyword">if</span> async <span class="token punctuation">{</span>
					<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						vi <span class="token operator">&lt;-</span> v
					<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					vi <span class="token operator">&lt;-</span> v
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å®é™…ä¸Šè¿™æ®µä»£ç æœ‰ goroutine æ³„éœ²çš„é£é™©ï¼Œå¦‚æœ out ä¸€ç›´ä¸è¢«æ¶ˆè´¹ï¼Œvalue çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œé‚£ä¹ˆè¿™ä¹ˆå¤šç­‰å¾…å‘é€ä¿¡æ¯çš„ goroutine å°±ä¼šå‘ç”Ÿæ³„éœ²é—®é¢˜</p> <p>è§£å†³æ–¹æ¡ˆæœ‰ä¸‹é¢å‡ ç§ï¼š</p> <ul><li>ä½¿ç”¨ä¿¡å·é‡å»æ§åˆ¶æœ€å¤šçš„ goroutine æ•°é‡</li> <li>ç»™æ¯ä¸€ä¸ª goroutine è®¾ç½®è¶…æ—¶æ—¶é—´</li> <li>æ§åˆ¶å‘é€çš„ value channel çš„å‘é€é¢‘ç‡</li> <li>ä½¿ç”¨ worker pool å»é™åˆ¶å¹¶å‘æ•°é‡</li></ul> <p>é‚£ä¹ˆè®©æˆ‘ä»¬ç”¨ä»£ç å»å®ç°è¿™äº›æ”¹è¿›çš„æ–¹æ¡ˆï¼š</p> <p>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ä¿¡å·é‡æ§åˆ¶</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  maxWorkers <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">GOMAXPROCS</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	sema       <span class="token operator">=</span> semaphore<span class="token punctuation">.</span><span class="token function">NewWeighted</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>maxWorkers<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// åœ¨ valueä¼ é€’ç»“æŸä¹‹åï¼Œè®°å¾—close value</span>
<span class="token keyword">func</span> <span class="token function">fanout</span><span class="token punctuation">(</span>value <span class="token keyword">chan</span> any<span class="token punctuation">,</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span> async <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				<span class="token function">close</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// å¯¹ä¸€ä¸ªnilçš„é€šé“è¿›è¡Œ for range éå†ä¼šå¯¼è‡´é˜»å¡(block)ã€‚</span>
		<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> value <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vi <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				vi <span class="token operator">:=</span> vi <span class="token comment">// if go version is lower then 1.22</span>
				<span class="token keyword">if</span> async <span class="token punctuation">{</span>
          ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">if</span> err <span class="token operator">:=</span> sema<span class="token punctuation">.</span><span class="token function">Acquire</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
						<span class="token keyword">break</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">defer</span> sema<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
						vi <span class="token operator">&lt;-</span> v
					<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					vi <span class="token operator">&lt;-</span> v
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨è¶…æ—¶æ—¶é—´</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">fanout</span><span class="token punctuation">(</span>value <span class="token keyword">chan</span> any<span class="token punctuation">,</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span> async <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				<span class="token function">close</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// å¯¹ä¸€ä¸ªnilçš„é€šé“è¿›è¡Œ for range éå†ä¼šå¯¼è‡´é˜»å¡(block)ã€‚</span>
		<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> value <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vi <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				vi <span class="token operator">:=</span> vi <span class="token comment">// if go version is lower then 1.22</span>
				<span class="token keyword">if</span> async <span class="token punctuation">{</span>
					<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">select</span><span class="token punctuation">{</span>
              <span class="token keyword">case</span> vi <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
              <span class="token keyword">case</span> time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
              <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
						
					<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					vi <span class="token operator">&lt;-</span> v
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ–¹æ¡ˆä¸‰ï¼šæ§åˆ¶å‘é€ value çš„å‘é€é¢‘ç‡</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>

			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;å…³é—­äº†å—&quot;</span><span class="token punctuation">)</span>
				<span class="token function">close</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token keyword">case</span> value <span class="token operator">&lt;-</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">:</span>
				time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span>
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€äº†å—&quot;</span><span class="token punctuation">)</span>

			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>æ–¹æ¡ˆå››ï¼šä½¿ç”¨ worker æ± å¤ç”¨ goroutine å»æ§åˆ¶å¹¶å‘çš„ goroutine æ•°é‡</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// github.com/shgopher/grpool</span>
<span class="token keyword">func</span> <span class="token function">fanout</span><span class="token punctuation">(</span>value <span class="token keyword">chan</span> any<span class="token punctuation">,</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span> async <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	pool <span class="token operator">:=</span> grpool<span class="token punctuation">.</span><span class="token function">NewPool</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> pool<span class="token punctuation">.</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				<span class="token function">close</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// å¯¹ä¸€ä¸ªnilçš„é€šé“è¿›è¡Œ for range éå†ä¼šå¯¼è‡´é˜»å¡(block)ã€‚</span>
		<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> value <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vi <span class="token operator">:=</span> <span class="token keyword">range</span> out <span class="token punctuation">{</span>
				<span class="token keyword">if</span> async <span class="token punctuation">{</span>
					pool<span class="token punctuation">.</span>JobQueue <span class="token operator">&lt;-</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						vi <span class="token operator">&lt;-</span> v
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					vi <span class="token operator">&lt;-</span> v
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>æŒ‰ç…§æˆ‘çš„å·¥ä½œç»éªŒï¼Œä½¿ç”¨å·¥ä½œæ± å’Œä¿¡å·é‡æ§åˆ¶ goroutine æ•°é‡çš„æ–¹æ³•æœ€ä¸ºå¸¸ç”¨ï¼Œä»–ä»¬éƒ½æ˜¯ä¿è¯æœ€å¤šåŒæ—¶å­˜åœ¨ n ä¸ª goroutineï¼Œè¿™æ ·å°±é¿å…äº† goroutine æ³„æ¼é—®é¢˜</p> <h3 id="map-reduce">map-reduce</h3> <p>æˆ‘ä»¬åœ¨å‡½æ•°é‚£ä¸ª<a href="https://github.com/shgopher/GOFamily/blob/aca91397692f99cd744fabcaca2055da3ec92c6f/%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E6%96%B9%E6%B3%95/1.md?plain=1#L11" target="_blank" rel="noopener noreferrer">ç« èŠ‚<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä»‹ç»è¿‡ map-reduce æ¨¡å¼ï¼Œä¸è¿‡å¹¶æ²¡æœ‰ç‰µæ¶‰åˆ°å¹¶å‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å¹¶å‘ç‰ˆçš„ map-reduce æ¨¡å¼
map</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">mapChan</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span>any<span class="token punctuation">)</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
  <span class="token keyword">if</span> in <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
    <span class="token keyword">return</span> out
  <span class="token punctuation">}</span>

  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
    <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
      out <span class="token operator">&lt;-</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre></div><p>reduce</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">reduceChan</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span><span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>v any<span class="token punctuation">)</span>any<span class="token punctuation">)</span>any <span class="token punctuation">{</span>
  <span class="token keyword">if</span> in <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>

  out <span class="token operator">&lt;-</span> in

  <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
    out <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span>v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>    
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre></div><h3 id="pipeline-æµæ°´çº¿æ¨¡å¼">pipeline-æµæ°´çº¿æ¨¡å¼</h3> <p>pipeline æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯é¡ºåºï¼Œå•çº¿æ¨¡å¼ï¼Œæ•°æ®ä»å¤´åˆ°å°¾ï¼Œé¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºæ˜¯ä¸‹ä¸€é˜¶æ®µçš„è¾“å…¥ã€‚</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> a A
a<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Download</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>è¿™å°±æ˜¯ pipeline çš„ä¸€ä¸ªç®€å•æ©é¥°ï¼Œå®ƒçš„åº•å±‚å¯èƒ½æ˜¯è¿™æ ·å®ç°çš„</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> A <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>A<span class="token punctuation">)</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>A<span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>A<span class="token punctuation">)</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>A<span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>A<span class="token punctuation">)</span><span class="token function">Download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>A<span class="token punctuation">{</span><span class="token keyword">return</span> a<span class="token punctuation">}</span>
</code></pre></div><p>é‚£ä¹ˆåœ¨å¹¶å‘çš„åœºæ™¯é‡Œï¼Œå¦‚ä½•ä½¿ goroutine å®ç° pipeline æ¨¡å¼å‘¢ï¼Ÿ</p> <p>è¿™æ˜¾ç„¶è·Ÿä¸€èˆ¬çš„æµæ°´çº¿å®ç°æ–¹æ³•ä¸åŒã€‚</p> <p>æˆ‘ä»¬å°† channel æ¯”ä½œä¸€ä¸ª tokenï¼Œæ‰€è°“ä»¤ç‰Œï¼Œåªè¦æˆ‘ä»¬æ§åˆ¶è·å–ä»¤ç‰Œçš„é¡ºåºï¼Œé‚£ä¹ˆå°±å¯ä»¥æ§åˆ¶æŒæœ‰è¿™äº›ä»¤ç‰Œçš„ goroutine é¡ºåºã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ 4 ä¸ª goroutine ä¾æ¬¡æ‰“å° â€œa b c dâ€ï¼Œ300 æ¬¡ï¼Œæˆ‘ä»¬ä½¿ç”¨æµæ°´çº¿çš„æ–¹å¼å®ç°ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Token <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	GNumber <span class="token builtin">int</span>
	Number  <span class="token builtin">int</span>
	sign    <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">world</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> id <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> Token<span class="token punctuation">,</span> out <span class="token keyword">chan</span> Token<span class="token punctuation">,</span> number <span class="token builtin">int</span><span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> number <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		token <span class="token operator">:=</span> <span class="token operator">&lt;-</span>in
		<span class="token function">fn</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    
    <span class="token comment">// è¿™æ®µä»£ç æ˜¯ä¸ºäº†ä¿è¯æœ€åä¸€ä¸ª goroutine æ‰§è¡Œå®Œæ¯•é€€å‡º </span>
		<span class="token keyword">if</span> id <span class="token operator">==</span> <span class="token punctuation">(</span>GNumber<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> number <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			<span class="token function">close</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>

		out <span class="token operator">&lt;-</span> token
		number<span class="token operator">--</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">RunPipeline</span><span class="token punctuation">(</span>GNumber <span class="token builtin">int</span><span class="token punctuation">,</span>Number <span class="token builtin">int</span><span class="token punctuation">,</span>chs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> Token<span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> GNumber <span class="token punctuation">{</span>
    <span class="token comment">// æ ¸å¿ƒä»£ç : </span>
    <span class="token comment">// ä¼ å…¥çš„in chan å’Œ out chan åˆšå¥½å‰åé¡ºåº</span>
    <span class="token comment">// è¿™æ · token æ‰èƒ½å‰åä¼ é€’</span>
		<span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> chs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> chs<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>GNumber<span class="token punctuation">]</span><span class="token punctuation">,</span> Number<span class="token punctuation">,</span>fn<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;-</span>sign

<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  GNumber <span class="token operator">=</span> <span class="token number">4</span>
	Number <span class="token operator">=</span> <span class="token number">300</span>
  chs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> Token<span class="token punctuation">{</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token function">RunPipeline</span><span class="token punctuation">(</span>GNumber<span class="token punctuation">,</span>Number<span class="token punctuation">,</span>chs<span class="token punctuation">,</span>world<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="stream-æµæ¨¡å¼">stream-æµæ¨¡å¼</h3> <p>å°† channel å½“åšæµå¼ç®¡é“ï¼Œæä¾›å¤šç§åŠŸèƒ½ï¼Œæ¯”å¦‚ç­›é€‰å…ƒç´ ï¼Œè·³è¿‡å…ƒç´ ç­‰</p> <p>å°†æ•°æ®è½¬åŒ–ä¸ºæµï¼Œå…¶ä¸­ channel å°±æ˜¯æµï¼Œä¼—å¤šæ•°æ®è¿™é‡Œæ˜¯ <code>...any</code></p> <p>åˆ›å»ºæµ</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">stream</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> values <span class="token operator">...</span>any<span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
				<span class="token keyword">return</span>
			<span class="token keyword">case</span> s <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span> 
</code></pre></div><p>æ ¹æ®æµï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä»¥ä¸‹çš„å¤„ç†</p> <ul><li>takeNï¼šåªå–æµä¸­çš„å‰ n ä¸ªæ•°æ®</li> <li>takeFnï¼šç­›é€‰æµä¸­çš„æ•°æ®ï¼Œåªä¿ç•™æ»¡è¶³æ¡ä»¶çš„æ•°æ®</li> <li>takeWhileï¼šåªå–å‰é¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼Œä¸€æ—¦ä¸æ»¡è¶³ï¼Œå°±ä¸å†å–äº†</li> <li>skipNï¼šè·³è¿‡æµä¸­çš„å‰ n ä¸ªæ•°æ®</li> <li>skipFnï¼šè·³è¿‡æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰æ•°æ®</li> <li>skipWhileï¼šè·³è¿‡å‰é¢æ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼Œä¸€æ—¦ä¸æ»¡è¶³æ¡ä»¶äº†ï¼Œå½“å‰è¿™ä¸ªå…ƒç´ å’Œä»¥åçš„å…ƒç´ éƒ½ä¼šè¾“å‡º</li></ul> <h4 id="taken">takeN</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TakeN</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>in <span class="token keyword">chan</span> any<span class="token punctuation">,</span>num <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token keyword">chan</span> any<span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
					<span class="token keyword">return</span> 
				<span class="token keyword">case</span> v<span class="token punctuation">,</span>ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span> in<span class="token punctuation">:</span>
					<span class="token keyword">if</span> ok  <span class="token punctuation">{</span>
						c <span class="token operator">&lt;-</span>v
					<span class="token punctuation">}</span>					
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h4 id="takefn">takeFn</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TakeFn</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>in <span class="token keyword">chan</span> any<span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token keyword">chan</span> any<span class="token punctuation">{</span>
	c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
		<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">select</span> <span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
					<span class="token keyword">return</span>
				<span class="token keyword">case</span> c <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>					
			  <span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h4 id="takewhile">takeWhile</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">takeWhile</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> any<span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token keyword">case</span> c <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> c 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="skipn">skipN</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">skipN</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> any<span class="token punctuation">,</span> n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        i <span class="token operator">:=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
            <span class="token keyword">if</span> i <span class="token operator">&lt;</span> n <span class="token punctuation">{</span>
                i<span class="token operator">++</span>
                <span class="token keyword">continue</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token keyword">case</span> c <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h4 id="skipfn">skipFn</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">skipFn</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> any<span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">select</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
                    <span class="token keyword">return</span>
                <span class="token keyword">case</span> c <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h4 id="skipwhile">skipWhile</h4> <div class="language-go extra-class"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token function">skipWhile</span><span class="token punctuation">(</span>done <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> any<span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>any<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">chan</span> any <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        skip <span class="token operator">:=</span> <span class="token boolean">true</span>
        <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
            <span class="token keyword">if</span> skip <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span>
            <span class="token punctuation">}</span>
            skip <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token keyword">select</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token operator">&lt;-</span>done<span class="token punctuation">:</span>
                <span class="token keyword">return</span>
            <span class="token keyword">case</span> c <span class="token operator">&lt;-</span> v<span class="token punctuation">:</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æµ‹è¯•-stream">æµ‹è¯• stream</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestStream</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  done <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>

  in <span class="token operator">:=</span> <span class="token function">stream</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

  <span class="token comment">// takeN</span>
  out <span class="token operator">:=</span> <span class="token function">takeN</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  want <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>
	
	<span class="token comment">// reflect.DeepEqual æ›´é€‚ç”¨äºåˆ¤æ–­å¤æ‚ç±»å‹çš„å˜é‡,</span>
	<span class="token comment">// åƒæ•°ç»„ã€åˆ‡ç‰‡ã€mapã€ç»“æ„ä½“ç­‰æ˜¯å¦ç›¸ç­‰,</span>
	<span class="token comment">// ç®€å•ç±»å‹å¯ä»¥ç”¨==è¿ç®—ç¬¦åˆ¤æ–­ã€‚</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;takeN = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// takeFn</span>
  fn <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>v any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    n <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> n<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  out <span class="token operator">=</span> <span class="token function">takeFn</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
  want <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;takeFn = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>

  <span class="token comment">// takeWhile</span>
  out <span class="token operator">=</span> <span class="token function">takeWhile</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>v any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  want <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;takeWhile = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// skipN </span>
  out <span class="token operator">=</span> <span class="token function">skipN</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  want <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;skipN = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// skipFn</span>
  out <span class="token operator">=</span> <span class="token function">skipFn</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>v any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  want <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;skipFn = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// skipWhile</span>
  out <span class="token operator">=</span> <span class="token function">skipWhile</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> in<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>v any<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  want <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> got <span class="token operator">:=</span> <span class="token function">drain</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;skipWhile = %v, want %v&quot;</span><span class="token punctuation">,</span> got<span class="token punctuation">,</span> want<span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">drain</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> any<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>any <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>any<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
    out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre></div><h3 id="pipeline-æµæ°´çº¿æ¨¡å¼å’Œ-stream-æµæ¨¡å¼çš„å¯¹æ¯”">pipeline æµæ°´çº¿æ¨¡å¼å’Œ stream æµæ¨¡å¼çš„å¯¹æ¯”</h3> <p>æµæ°´çº¿æ¨¡å¼ (Pipeline Pattern) å’Œæµæ¨¡å¼ (Stream Pattern) éƒ½æ˜¯å°†ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªé˜¶æ®µæ¥å¤„ç†ï¼Œä½†ä¸¤è€…è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ï¼š</p> <ul><li>æ•°æ®æµåŠ¨æ–¹å‘ä¸åŒ
<ul><li>æµæ°´çº¿æ¨¡å¼æ˜¯ä¸€æ¡ä¸»çº¿ï¼Œæ•°æ®ä»å¤´æµåˆ°å°¾ï¼Œæ¯ä¸ªé˜¶æ®µå¤„ç†å®Œè¾“å‡ºç»™ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</li> <li>æµæ¨¡å¼æ˜¯å¤šæ¡åˆ†æ”¯ï¼Œæ•°æ®å¯ä»¥ä»å¤šä¸ªæ¥æºæµå…¥ï¼Œç»è¿‡å¤„ç†æµå‘å¤šä¸ªå»å¤„ã€‚</li></ul></li> <li>æ‰§è¡Œæ–¹å¼ä¸åŒ
<ul><li>æµæ°´çº¿æ¨¡å¼å¼ºè°ƒé˜¶æ®µé—´<strong>ä¸²è¡Œæ‰§è¡Œ</strong>ã€‚<strong>ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºæ˜¯ä¸‹ä¸€é˜¶æ®µçš„è¾“å…¥</strong>ã€‚</li> <li>æµæ¨¡å¼å¯ä»¥<strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼Œ<strong>ä¸åŒé˜¶æ®µå¯ä»¥åŒæ—¶æ“ä½œä¸åŒæ•°æ®</strong>ã€‚</li></ul></li> <li>è¿æ¥æ–¹å¼ä¸åŒ
<ul><li>æµæ°´çº¿æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªé˜¶æ®µé å›ºå®šç®¡é“è¿æ¥ï¼Œé¡ºåºä¸èƒ½æ”¹å˜ã€‚</li> <li>æµæ¨¡å¼ä¸­ï¼Œæµå¯ä»¥æ›´çµæ´»è‡ªç”±åœ°è¿æ¥ã€‚</li></ul></li> <li>æ‰©å±•æ€§ä¸åŒ
<ul><li>æµæ°´çº¿æ¨¡å¼æ‰©å±•ä¸€ä¸ªé˜¶æ®µå¯èƒ½å½±å“æ•´ä¸ªæµæ°´çº¿ã€‚</li> <li>æµæ¨¡å¼æ‰©å±•ä¸€ä¸ªé˜¶æ®µå¯¹å…¶ä»–é˜¶æ®µå½±å“å¾ˆå°ã€‚</li></ul></li></ul> <p>æ€»ç»“ï¼š</p> <ul><li>æµæ°´çº¿æ¨¡å¼æ³¨é‡å°†ä»»åŠ¡åˆ’åˆ†å¤šä¸ªçº¿æ€§æ‰§è¡Œçš„å›ºå®šé˜¶æ®µã€‚</li> <li>æµæ¨¡å¼æ³¨é‡æ„å»ºçµæ´»çš„æµå¤„ç†æµç¨‹ï¼Œæµå¯ä»¥å¹¶è¡Œè¿åŠ¨ã€‚</li></ul> <p>æ‰€ä»¥ä¸¤è€…ä¾§é‡ç‚¹ä¸åŒï¼Œåœ¨ä½¿ç”¨ä¸Šä¹Ÿæœ‰åŒºåˆ«ã€‚</p> <h2 id="channel-æ³¨æ„äº‹é¡¹">channel æ³¨æ„äº‹é¡¹</h2> <p>å‘ç”Ÿä¸‹é¢äº‹é¡¹ä¸€å®šä¼šè§¦å‘ panicï¼š</p> <ul><li>å‘å·²ç»å…³é—­çš„ channel ä¸­å‘é€æ•°æ®</li> <li>å…³é—­ä¸€ä¸ª nil channel</li> <li>å…³é—­ä¸€ä¸ªå·²ç»è¢«å…³é—­çš„ channel</li></ul> <h3 id="goroutine-æ³„éœ²">goroutine æ³„éœ²</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">12</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">select</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ch è¢«å…³é—­äº†&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“ time.After(time.Second) æ‰§è¡Œå®Œæ¯•ä»¥åï¼Œä¸Šé¢é‚£ä¸ª goroutine å› ä¸ºæ— æ³•æ¥æ”¶æ•°æ®ï¼Œæ‰€ä»¥å°±ä¼šä¸€ç›´é˜»å¡åœ¨å‘é€æ•°æ®é‚£ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥è¿™ä¸ªä»£ç ä¸­ï¼Œgoroutine å°±ä¼šæ³„éœ²äº†ã€‚</p> <p>è§£å†³ä¹‹é“å°±æ˜¯å°†å®¹é‡è®¾ç½®ä¸º 1 å³å¯ï¼š</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
    ch <span class="token operator">&lt;-</span> <span class="token number">12</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">select</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ch<span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;ch è¢«å…³é—­äº†&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“è®¾ç½®ä¸º 1 çš„æ—¶å€™ï¼Œå³ä½¿æ²¡æœ‰æ¥å—è€…äº†ï¼Œå‘é€è¿™ä¸ªåœ°æ–¹çš„ä»£ç ä¹Ÿèƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥è¿™ä¸ª goroutine æ˜¯ä¸ä¼šæ³„éœ²äº†ã€‚</p> <p>è¿™é‡Œæ’ä¸€å¥ï¼Œmain goroutine åªè¦é€€å‡ºï¼Œå…¶å®ƒ goroutine ä¸ç®¡æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ä¹Ÿä¼šé€€å‡ºï¼Œæ‰€ä»¥å¦‚æœè¿™ç§ä»£ç åœ¨ main å‡½æ•°ä¸­å‡ºç°ï¼Œé‚£ä¹ˆæ˜¯ä¸ä¼šå‘ç”Ÿ goroutine æ³„éœ²é—®é¢˜çš„ï¼Œå› ä¸ºï¼š</p> <p><em><strong>main å‡½æ•°ç»“æŸä»¥åï¼Œå…¶å®ƒ goroutine è‡ªåŠ¨ç»“æŸ</strong></em></p> <h2 id="channle-å’Œè¿è¡Œæ—¶è°ƒåº¦å¦‚ä½•äº¤äº’">channle å’Œè¿è¡Œæ—¶è°ƒåº¦å¦‚ä½•äº¤äº’</h2> <p>channel å’Œ Go è¿è¡Œæ—¶è°ƒåº¦å™¨çš„äº¤äº’æ–¹å¼å¦‚ä¸‹ï¼š</p> <ol><li><p>å½“ goroutine å‘ channel å‘é€æ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨ runtime.chansend å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåˆ¤æ–­ channel æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ»¡äº†åˆ™è®© goroutine è¿›å…¥é˜»å¡ç­‰å¾…ã€‚</p></li> <li><p>å½“ goroutine ä» channel æ¥æ”¶æ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨ runtime.chanrecv å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåˆ¤æ–­ channel æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è®© goroutine è¿›å…¥é˜»å¡ç­‰å¾…ã€‚</p></li> <li><p>è¿è¡Œæ—¶è°ƒåº¦å™¨é€šè¿‡ç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—æ¥ç®¡ç†è¢«é˜»å¡çš„ goroutineã€‚å½“ channel å¯è¯»å†™æ—¶ï¼Œä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­å¼¹å‡º goroutine ç»§ç»­è¿è¡Œã€‚</p></li> <li><p>è¿è¡Œæ—¶è°ƒåº¦å™¨ä»¥éå¸¸é«˜é¢‘ç‡è¿è¡Œï¼Œä¼šåœ¨ goroutine ä¹‹é—´å¿«é€Ÿåˆ‡æ¢ã€‚è¿™ç»™ç”¨æˆ·çš„æ„Ÿè§‰å°±æ˜¯ goroutine å¹¶å‘è¿è¡Œã€‚</p></li> <li><p>channel çš„å‘é€æ¥æ”¶åŠ¨ä½œå¿…é¡»åŒ¹é…ï¼Œå¦åˆ™ç¨‹åºä¼šæ­»é”ã€‚è°ƒåº¦å™¨è¯•å›¾é‡æ’å‘é€æ¥æ”¶é¡ºåºæ¥é¿å…æ­»é”ã€‚</p></li></ol> <p>æ€»ç»“æ¥è¯´ï¼Œchannel çš„é˜»å¡æ˜¯å»ºç«‹åœ¨è¿è¡Œæ—¶è°ƒåº¦å™¨çš„åŸºç¡€ä¸Šã€‚è°ƒåº¦å™¨ç®¡ç†è¢«é˜»å¡çš„ goroutine é˜Ÿåˆ—ï¼Œåœ¨æ¡ä»¶å…è®¸æ—¶æ¢å¤ goroutine ç»§ç»­è¿è¡Œã€‚channel çš„ä½¿ç”¨ä¿è¯äº†æ•°æ®çš„åŒæ­¥ä¼ é€’ã€‚</p> <h3 id="å¦‚æœå»æ‰-channel-goroutine-å°±å¯ä»¥çœŸå®çš„å¹¶è¡Œäº†å—">å¦‚æœå»æ‰ channelï¼Œgoroutine å°±å¯ä»¥çœŸå®çš„å¹¶è¡Œäº†å—</h3> <p>å¦‚æœæ²¡æœ‰ channel çš„è¯ï¼Œgoroutine å¯ä»¥çœŸæ­£å¹¶è¡Œæ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ã€‚</p> <p>channel çš„å‘é€æ¥æ”¶æœºåˆ¶ï¼Œä¼šåœ¨å¯¹ç«¯æœªå‡†å¤‡å¥½æ—¶é€ æˆ goroutine é˜»å¡ã€‚è¿™å°±ä¼šå¼•èµ· goroutine ä¹‹é—´çš„åŒæ­¥å…³ç³»ã€‚</p> <p>è€Œå¦‚æœæ²¡æœ‰ channelï¼š</p> <ol><li><p>goroutine ä¹‹é—´ä¸å­˜åœ¨åŒæ­¥ä¾èµ–ï¼Œå¯ä»¥ä»»æ„äº¤å‰æ‰§è¡Œã€‚</p></li> <li><p>ç¨‹åºéœ€è¦è‡ªå·±ç»´æŠ¤ç«äº‰å’ŒåŒæ­¥é€»è¾‘ï¼Œè¾ƒéš¾å¤„ç†å¥½å¹¶å‘é—®é¢˜ã€‚</p></li> <li><p>goroutine æ— æ³•é€šè¿‡ channel é€šä¿¡ï¼Œå¿…é¡»ä½¿ç”¨å…±äº«å˜é‡ï¼Œå¢åŠ ç«äº‰é£é™©ã€‚</p></li> <li><p>ç¨‹åºæ•´ä½“å¹¶å‘æ•ˆæœå¯èƒ½æ›´å¥½ï¼Œä½†å¤æ‚åº¦å’Œé”™è¯¯é£é™©éƒ½æ›´é«˜ã€‚</p></li> <li><p>ä¸§å¤±äº† channel å¸¦æ¥çš„å¯ç»„åˆæ€§ã€è¡¨è¾¾èƒ½åŠ›ç­‰ä¼˜åŠ¿ã€‚</p></li></ol> <p>æ‰€ä»¥ channel çš„å¼•å…¥è®©ç¼–ç¨‹å˜å¤æ‚ï¼Œä½†æ”¶è·æ˜¯å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚éœ€è¦æ ¹æ®å®é™…æƒ…å†µæƒè¡¡ channel çš„å¼•å…¥å¸¦æ¥çš„æ”¶ç›Šã€‚</p> <p>å¦‚æœéè¦æœ€å¤§ç¨‹åº¦å‘æŒ¥å¹¶è¡Œï¼Œç¡®å®å¯ä»¥è€ƒè™‘å»æ‰ channelï¼Œä½†æˆåŠŸçš„å¹¶å‘ç¨‹åºå¾€å¾€ä¸æ˜¯ä¾é çº¯å¹¶è¡Œæ¥å®ç°çš„ã€‚</p> <p>è¿™éœ€è¦æ ¹æ®å…·ä½“æƒ…å½¢æ¥æƒè¡¡ channel çš„å¼•å…¥å¸¦æ¥çš„æ”¶ç›Šå’Œå¤æ‚åº¦ã€‚</p> <h3 id="channel-åº•å±‚å®é™…ä¸Šæ˜¯äº’æ–¥é”-é˜»å¡æœºåˆ¶ä¹Ÿç¬¦åˆäº’æ–¥é”å¯¹äº-goroutine-çš„é˜»å¡è§„åˆ™å—">channel åº•å±‚å®é™…ä¸Šæ˜¯äº’æ–¥é”ï¼Œé˜»å¡æœºåˆ¶ä¹Ÿç¬¦åˆäº’æ–¥é”å¯¹äº goroutine çš„é˜»å¡è§„åˆ™å—</h3> <p>channel çš„å‘é€æ¥æ”¶åœ¨åº•å±‚ä¼šä½¿ç”¨äº’æ–¥é”æ¥å®ç°åŒæ­¥ã€‚æ‰€ä»¥å®ƒç»§æ‰¿äº†äº’æ–¥é”ä¸€äº›å†…åœ¨çš„ç‰¹æ€§ï¼š</p> <ol><li><p>é˜»å¡çš„ goroutine ä¼šå½¢æˆ FIFO (å…ˆè¿›å…ˆå‡º) çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œè¿™ç¡®ä¿äº†å…¬å¹³æ€§ã€‚</p></li> <li><p>runtime ä¼šä¼˜å…ˆå”¤é†’ç­‰å¾…æ—¶é—´æœ€é•¿çš„ goroutineï¼Œé˜²æ­¢é¥¥é¥¿ã€‚</p></li> <li><p>å‘é€å’Œæ¥æ”¶æœ‰æ—¶ä¼šé‡‡ç”¨çŸ­æš‚çš„è‡ªæ—‹ç­‰å¾…é”ï¼Œé¿å…è¿‡æ—©ä¼‘çœ çº¿ç¨‹ã€‚</p></li> <li><p>å‘é€æ–¹å’Œæ¥æ”¶æ–¹äº‰ç”¨åŒä¸€ä¸ªé”ï¼Œè¿™ä¼šå¼•èµ·ä¼˜å…ˆçº§åè½¬ç­‰é—®é¢˜ã€‚</p></li></ol> <p>ä½†æ˜¯</p> <p>channel çš„å®ç°è¦æ¯”ç›´æ¥ä½¿ç”¨é”æ›´å¤æ‚ï¼Œå®ƒå†…éƒ¨åšäº†å¾ˆå¤šä¼˜åŒ–ï¼š</p> <ol><li><p>éé˜»å¡å‘é€å’Œæ¥æ”¶ä¼šè¢«ä¼˜å…ˆæ‰§è¡Œï¼Œé¿å…ä¸å¿…è¦çš„é˜»å¡ã€‚</p></li> <li><p>å°½é‡é¿å…çº¿ç¨‹ä¼‘çœ ï¼Œå‡å°‘é”çš„äº‰ç”¨ã€‚</p></li> <li><p>å¤šæ ¸å¿ƒä¼šå¹¶è¡ŒåŒ¹é…å‘é€å’Œæ¥æ”¶ç­‰ã€‚</p></li> <li><p>å¯è°ƒèŠ‚çš„ç¼“å†²åŒºå¤§å°å¯æ ¹æ®åœºæ™¯ä¼˜åŒ–ååé‡ã€‚</p></li></ol> <p>ç»¼ä¸Šï¼Œchannel ç»§æ‰¿äº†äº’æ–¥é”çš„ä¸€äº›å†…åœ¨ç‰¹æ€§ï¼Œä½†å®ƒçš„å®ç°è¦å¤æ‚å¾ˆå¤šï¼Œåšäº†å¤§é‡ä¼˜åŒ–æ¥å‡å°‘é”äº‰ç”¨çš„å½±å“ã€‚</p> <p>æ‰€ä»¥ä½¿ç”¨ channel çš„ä¿¡å·é‡æ¨¡å¼å»å®ç°çš„äº’æ–¥é”å¹¶ä¸é€‚åˆï¼Œå› ä¸ºå®ƒæ¯” go æœ¬èº«çš„äº’æ–¥é”æ›´åŠ å¤æ‚</p> <h2 id="issues">issues</h2> <h3 id="channel-æ˜¯å¹¶å‘é“¶å¼¹å—">channel æ˜¯å¹¶å‘é“¶å¼¹å—ï¼Ÿ</h3> <p>åœ¨ go è¯­è¨€ä¸­ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯æ˜¯ä½¿ç”¨ channel æ›´æœ‰ä¼˜åŠ¿ï¼Œæ¯”å¦‚ä¸Šæ–‡æåˆ°çš„é‚£å‡ ç§åœºæ™¯ï¼Œä¾‹å¦‚æ•°æ®çš„ä¼ é€’ä»¥åŠä»»åŠ¡ç¼–æ’ï¼Œéœ€è¦è·Ÿ select æˆ–è€… context ç»“åˆï¼Œé‚£ä¹ˆè¿™éƒ½æ˜¯ channel çš„é€‚ç”¨åœºæ™¯</p> <p>ä¸è¿‡å¦‚æœæ˜¯å¯¹äºå…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„äº’æ–¥é”æ›´æœ‰ä¼˜åŠ¿ä¸€äº›</p> <p>å¦‚æœåªæ˜¯çº¿ç¨‹å®‰å…¨çš„å¯¹äºæŸä¸ªå˜é‡çš„æ•°æ®å˜æ›´ï¼Œä½¿ç”¨åŸå­åŒ…æ˜¾ç„¶æ˜¯æ›´åŠ åˆé€‚çš„é€‰æ‹©</p> <h3 id="æœ‰æ— -buffer-çš„-channel-åŒºåˆ«">æœ‰æ—  buffer çš„ channel åŒºåˆ«</h3> <p>go è¯­è¨€ä¸­ç»å¸¸ä¼šå‡ºç°ä¸€ä¸ª bugï¼Œå°±æ˜¯æ­»é”ï¼Œå¾ˆå¤šéƒ½å¾ˆæ²¡æœ‰è®¾ç½® channel ç¼“å­˜æœ‰å…³ï¼Œæœ‰çš„æ—¶å€™ç»™ channel è®¾ç½®ä¸€ä¸ªç¼“å­˜å¾€å¾€å¯ä»¥è§„é¿å¾ˆå¤šçš„ panic é£é™©</p> <h3 id="channel-close-å-read-write-close-çš„åŒºåˆ«">channel close åï¼Œread write close çš„åŒºåˆ«</h3> <ul><li>readï¼šæ­£å¸¸å€¼+é›¶å€¼</li> <li>closeï¼španic</li> <li>writeï¼španic</li></ul> <h3 id="channle-åº•å±‚æ˜¯ä»€ä¹ˆ">channle åº•å±‚æ˜¯ä»€ä¹ˆ</h3> <p>ä¸€ä¸ªå†…éƒ¨æœ‰é”çš„å¾ªç¯é˜Ÿåˆ—</p> <p>channel åœ¨ Go è¯­è¨€ä¸­çš„åº•å±‚å®ç°ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p> <ol><li><p>æ•°æ®ç»“æ„ï¼šchannel åœ¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨ç¼“å†²åŒºçš„æ•°æ® (æœ‰ç¼“å­˜çš„è¯)ï¼ŒåŒæ—¶æœ‰å‘é€æ–¹ã€æ¥æ”¶æ–¹çš„æŒ‡é’ˆã€‚</p></li> <li><p>åŒæ­¥æœºåˆ¶ï¼šä½¿ç”¨äº’æ–¥é” (Mutex) å’Œæ¡ä»¶å˜é‡ (Cond) å®ç°åŒæ­¥ï¼Œä¿è¯å¹¶å‘å®‰å…¨ã€‚</p></li> <li><p>è°ƒåº¦æœºåˆ¶ï¼šé€šè¿‡è¿è¡Œæ—¶è°ƒåº¦å™¨ç®¡ç† goroutine çš„é˜»å¡å’Œå”¤é†’ï¼Œç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—ã€‚</p></li> <li><p>å†…å­˜ç®¡ç†ï¼šä¸è¿è¡Œæ—¶å†…å­˜ç®¡ç†ç´§å¯†ç»“åˆï¼Œç¼“å†²åŒºæ•°æ®çš„å†…å­˜åˆ†é…ä¸é‡Šæ”¾ã€‚</p></li> <li><p>æ€§èƒ½ä¼˜åŒ–ï¼šè´Ÿè½½å‡è¡¡ã€æœ¬åœ°é˜Ÿåˆ—ç­‰æ–¹å¼æé«˜æ€§èƒ½ã€‚</p></li></ol> <p>å…·ä½“è€Œè¨€ï¼Œchannel çš„æ•°æ®ç»“æ„ hchan ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p> <ul><li>bufï¼šå¾ªç¯é˜Ÿåˆ—ï¼Œç»´æŠ¤ç¼“å†²åŒº</li> <li>sendx/recvxï¼šå‘é€å’Œæ¥æ”¶æŒ‡é’ˆ</li> <li>lockï¼šäº’æ–¥é”</li> <li>sendsema/recvsemaï¼šå‘é€å’Œæ¥æ”¶çš„æ¡ä»¶å˜é‡</li></ul> <p>å‘é€æ¥æ”¶æ—¶éœ€è¦è·å–äº’æ–¥é”ï¼Œé˜»å¡æ—¶ç­‰å¾…æ¡ä»¶å˜é‡ã€‚è°ƒåº¦å™¨ basis ä¸Šç»´æŠ¤ç­‰å¾…é˜Ÿåˆ—ã€‚</p> <h3 id="ç¼–ç¨‹é¢˜-ä½¿ç”¨ä¸‰ä¸ª-goroutine-æ‰“å°-abc-100-æ¬¡">ç¼–ç¨‹é¢˜ï¼Œä½¿ç”¨ä¸‰ä¸ª goroutine æ‰“å° abc 100 æ¬¡</h3> <p>ä¸Šæ–‡æåˆ°çš„ channel ä»»åŠ¡ç¼–æ’ä¸­çš„ pipeline æµæ°´çº¿æ¨¡å¼å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Token <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
	GNumber <span class="token builtin">int</span>
	Number  <span class="token builtin">int</span>
	sign    <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">world</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> id <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">worker</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">,</span> in <span class="token keyword">chan</span> Token<span class="token punctuation">,</span> out <span class="token keyword">chan</span> Token<span class="token punctuation">,</span> number <span class="token builtin">int</span><span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> number <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		token <span class="token operator">:=</span> <span class="token operator">&lt;-</span>in
		<span class="token function">fn</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
		<span class="token keyword">if</span> id <span class="token operator">==</span> <span class="token punctuation">(</span>GNumber<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> number <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
			<span class="token function">close</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span> 
		out <span class="token operator">&lt;-</span> token
		number<span class="token operator">--</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">RunPipeline</span><span class="token punctuation">(</span>GNumber <span class="token builtin">int</span><span class="token punctuation">,</span>Number <span class="token builtin">int</span><span class="token punctuation">,</span>chs<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> Token<span class="token punctuation">,</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> GNumber <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token function">worker</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> chs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> chs<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>GNumber<span class="token punctuation">]</span><span class="token punctuation">,</span> Number<span class="token punctuation">,</span>fn<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	chs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;-</span>sign

<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  GNumber <span class="token operator">=</span> <span class="token number">3</span>
	Number <span class="token operator">=</span> <span class="token number">100</span>
  chs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">chan</span> Token<span class="token punctuation">{</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> Token<span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token function">RunPipeline</span><span class="token punctuation">(</span>GNumber<span class="token punctuation">,</span>Number<span class="token punctuation">,</span>chs<span class="token punctuation">,</span>world<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åŒ…æ‹¬ä¹‹å‰çš„æ°´ç”Ÿæˆå·¥å‚é‚£é“é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ pieline æ¨¡å¼æ¥è§£å†³ï¼Œæ›¿æ¢æ‰ä¹‹å‰ä½¿ç”¨çš„ waitgroup å’Œä¿¡å·é‡ï¼Œä»¥åŠå¾ªç¯æ …æ </p> <h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2> <ul><li>https://betterprogramming.pub/common-goroutine-leaks-that-you-should-avoid-fe12d12d6ee</li> <li>https://github.com/fortytw2/leaktest</li> <li>https://cloud.tencent.com/developer/article/1921580</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/shgopher/GOFamily/edit/release/å¹¶å‘/channel/README.md" target="_blank" rel="noopener noreferrer">åœ¨GitHubä¸­ç¼–è¾‘</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°:</span> <span class="time">3/13/2024, 4:38:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/GOFamily/assets/js/app.6dac5fbf.js" defer></script><script src="/GOFamily/assets/js/2.5c331e53.js" defer></script><script src="/GOFamily/assets/js/106.ee0a923b.js" defer></script>
  </body>
</html>
